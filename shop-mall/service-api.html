<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>五、微服务分布式电商系统--商品服务API接口 - ZhangYao&#039;s Blog</title><meta description="【摘要】商品服务API接口~"><meta property="og:type" content="blog"><meta property="og:title" content="五、微服务分布式电商系统--商品服务API接口"><meta property="og:url" content="http://www.aizhangyao.com/shop-mall/service-api.html"><meta property="og:site_name" content="ZhangYao&#039;s Blog"><meta property="og:description" content="【摘要】商品服务API接口~"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/cover.jpeg"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/pms_category.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/data-b.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/create-sys-menu.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/category-vue.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/component-tree.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-404.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/baseUrl.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-nocas-renren-fast.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-gateway.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/CORS-error.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-process.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-solve.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-solve-2.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-gateway.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/login-options.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/login-post.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-404-2.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-gateway-product.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-200.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-category.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/element-ui-component-tree.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-category-delete-append.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/post-man.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/mybatis-plus-logic-delete.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/file-store.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-aliyun.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/bucket.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-common.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-sign.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/use-java-sdk.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/aliyun-oss-full-acess.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/server-sign-oss-doc.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-image.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/jiaoyan.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/validation-jsr303.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/attr-group.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/spu-sku-attr.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/spu-sku-attr-table.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/attr-group-effect.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-attrgroup.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-attrgroup-add.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-category-brand-relation.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-category-brand-relation.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/add-base-attr.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-pms-attr.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-pms-attr-attrgroup-relation.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-product-base-attr.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-product-base-attr-category-group.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-attrgroup-crud.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/member-level.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/json2javapojo.png"><meta property="article:published_time" content="2020-06-21T23:27:57.000Z"><meta property="article:modified_time" content="2020-11-27T14:33:48.341Z"><meta property="article:author" content="ZhangYao"><meta property="article:tag" content="ShopMall"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/images/shop-mall/service-api/cover.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.aizhangyao.com/shop-mall/service-api.html"},"headline":"ZhangYao's Blog","image":["http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/pms_category.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/data-b.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/create-sys-menu.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/category-vue.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/component-tree.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-404.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/baseUrl.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-nocas-renren-fast.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-gateway.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/CORS-error.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-process.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-solve.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-solve-2.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/cross-domain-gateway.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/login-options.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/login-post.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-404-2.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/config-gateway-product.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/get-tree-200.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-category.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/element-ui-component-tree.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-category-delete-append.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/post-man.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/mybatis-plus-logic-delete.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/file-store.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-aliyun.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/bucket.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-common.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/oss-sign.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/use-java-sdk.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/aliyun-oss-full-acess.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/server-sign-oss-doc.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-image.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/jiaoyan.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/validation-jsr303.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/attr-group.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/spu-sku-attr.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/spu-sku-attr-table.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/attr-group-effect.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-attrgroup.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-attrgroup-add.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-category-brand-relation.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-category-brand-relation.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/add-base-attr.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-pms-attr.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/db-pms-attr-attrgroup-relation.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-product-base-attr.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/show-product-base-attr-category-group.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/product-attrgroup-crud.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/member-level.png","http://www.aizhangyao.com/gallery/images/shop-mall/service-api/product/json2javapojo.png"],"datePublished":"2020-06-21T23:27:57.000Z","dateModified":"2020-11-27T14:33:48.341Z","author":{"@type":"Person","name":"ZhangYao"},"description":"【摘要】商品服务API接口~"}</script><link rel="canonical" href="http://www.aizhangyao.com/shop-mall/service-api.html"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ZhangYao&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/aizhangyao"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-21T23:27:57.000Z" title="2020-06-21T23:27:57.000Z">2020-06-21</time><span class="level-item"><a class="link-muted" href="/categories/ShopMall/">ShopMall</a></span><span class="level-item">1 小时 读完 (大约 7275 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">五、微服务分布式电商系统--商品服务API接口</h1><div class="content"><p>【摘要】商品服务API接口~<br><img src="/gallery/images/shop-mall/service-api/cover.jpeg" alt=""></p>
<a id="more"></a>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h1 id="商品服务-API-三级分类-查询-递归树形结构数据获取"><a href="#商品服务-API-三级分类-查询-递归树形结构数据获取" class="headerlink" title="商品服务-API-三级分类-查询-递归树形结构数据获取"></a>商品服务-API-三级分类-查询-递归树形结构数据获取</h1><p>所有的分类数据从数据库读取，对应数据库pms_category。<br><img src="/gallery/images/shop-mall/service-api/product/pms_category.png" alt=""><br>首先在数据库准备数据，然后再我们zheli-product中找到和分类有关的代码。<br>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"product/category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查出所有分类以及子分类，以树形结构组装起来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list/tree"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(@RequestParam Map&lt;String, Object&gt; params)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;CategoryEntity&gt; entities = categoryService.listWithTree();</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">"data"</span>,entities);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品三级分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">CategoryEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;CategoryEntity&gt; <span class="title">listWithTree</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"categoryService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryDao</span>, <span class="title">CategoryEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">//    CategoryDao categoryDao;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        IPage&lt;CategoryEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;CategoryEntity&gt;().getPage(params),</span><br><span class="line">                <span class="keyword">new</span> QueryWrapper&lt;CategoryEntity&gt;()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">listWithTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.查出所有分类</span></span><br><span class="line">        List&lt;CategoryEntity&gt; entities = baseMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.组装成父子的树形结构</span></span><br><span class="line">        <span class="comment">//2.1找到所有的一级分类</span></span><br><span class="line">        List&lt;CategoryEntity&gt; level1Menus = entities.stream().filter(categoryEntity -&gt;</span><br><span class="line">                categoryEntity.getParentCid() == <span class="number">0</span></span><br><span class="line">        ).map((menu) -&gt; &#123;</span><br><span class="line">            menu.setChildren(getChildrens(menu, entities));</span><br><span class="line">            <span class="keyword">return</span> menu;</span><br><span class="line">        &#125;).sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> (menu1.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu1.getSort()) - (menu2.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> level1Menus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//递归查找所有菜单的子菜单</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title">getChildrens</span><span class="params">(CategoryEntity root, List&lt;CategoryEntity&gt; all)</span> </span>&#123;</span><br><span class="line">        List&lt;CategoryEntity&gt; children = all.stream().filter(categoryEntity -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> categoryEntity.getParentCid() == root.getCatId();</span><br><span class="line">        &#125;).map(categoryEntity -&gt; &#123;</span><br><span class="line">            <span class="comment">//1.找到子菜单</span></span><br><span class="line">            categoryEntity.setChildren(getChildrens(categoryEntity, all));</span><br><span class="line">            <span class="keyword">return</span> categoryEntity;</span><br><span class="line">        &#125;).sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">            <span class="comment">//2.菜单的排序</span></span><br><span class="line">            <span class="keyword">return</span> (menu1.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu1.getSort()) - (menu2.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试运行。<br><img src="/gallery/images/shop-mall/service-api/product/data-b.png" alt=""></p>
<h1 id="商品服务-API-三级分类-配置网关路由和路径重写"><a href="#商品服务-API-三级分类-配置网关路由和路径重写" class="headerlink" title="商品服务-API-三级分类-配置网关路由和路径重写"></a>商品服务-API-三级分类-配置网关路由和路径重写</h1><p>启动人人快速开发平台。在菜单管理新建<code>商品系统</code>目录，并在商品系统目录下新建<code>分类维护</code>菜单。<br><img src="/gallery/images/shop-mall/service-api/product/create-sys-menu.png" alt=""><br>在前端项目中新建category.vue文件。<br><img src="/gallery/images/shop-mall/service-api/product/category-vue.png" alt=""><br>使用ElementUI的树形控件：<a href="https://element.eleme.cn/#/zh-CN/component/tree">https://element.eleme.cn/#/zh-CN/component/tree</a><br><img src="/gallery/images/shop-mall/service-api/product/component-tree.png" alt=""><br>之后在category.vue编写前端代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree :data=<span class="string">"data"</span> :props=<span class="string">"defaultProps"</span> @node-click=<span class="string">"handleNodeClick"</span>&gt;&lt;<span class="regexp">/el-tree&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      data: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: <span class="string">"children"</span>,</span><br><span class="line">        label: <span class="string">"label"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleNodeClick(data) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">        url: <span class="keyword">this</span>.$http.adornUrl(<span class="string">"/product/category/list/tree"</span>),</span><br><span class="line">        method: <span class="string">"get"</span></span><br><span class="line">      &#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"成功获取到菜单数据..."</span>,data)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">      <span class="keyword">this</span>.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;style lang='scss' scoped&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure>
<p>页面访问发现没有数据，打开浏览器控制台发现404。发现这里是对<code>http://localhost:8080/renren-fast/product/category/list/tree</code>进行请求获取数据。实际上，需要从<code>http://localhost:8000/product/category/list/tree</code>获取数据。<br><img src="/gallery/images/shop-mall/service-api/product/get-tree-404.png" alt=""><br>其实如果只是改变<code>http://localhost:8080/renren-fast/</code>这部分基准路径，那么后面分布式情况下需要给<code>8001``8002``...</code>发送请求就还会出现问题。所以找到前端基准路径设置成给网关发请求。<br><img src="/gallery/images/shop-mall/service-api/product/baseUrl.png" alt=""><br>上面的设置成功之后，发现验证码请求不到。原因是因为验证码功能是renren-fast后台提供的，现在所有请求都会去网关服务找。要让网关可以发现这个验证码服务，就需要把renren-fast后台服务注册到nacos注册中心中。1.引入zheli-common。2.在application.yml中配置服务名字。 3.配置注册中心地址。4.开启服务的注册发现@EnableDiscoveryClient。5.重启renren-fast。<br><img src="/gallery/images/shop-mall/service-api/product/config-nocas-renren-fast.png" alt=""><br>之后配置网关路由和路径重写。<br><img src="/gallery/images/shop-mall/service-api/product/config-gateway.png" alt=""><br>重新登录遇到跨域问题。<br><img src="/gallery/images/shop-mall/service-api/product/CORS-error.png" alt=""></p>
<h1 id="商品服务-API-三级分类-网关统一配置跨域"><a href="#商品服务-API-三级分类-网关统一配置跨域" class="headerlink" title="商品服务-API-三级分类-网关统一配置跨域"></a>商品服务-API-三级分类-网关统一配置跨域</h1><p><img src="/gallery/images/shop-mall/service-api/product/cross-domain.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/cross-domain-process.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/cross-domain-solve.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/cross-domain-solve-2.png" alt=""><br>这里选择第二种配置请求允许跨域。<br><img src="/gallery/images/shop-mall/service-api/product/cross-domain-gateway.png" alt=""><br>配置完成后，重启网关服务和renren-fast服务。然后在页面重写登录。<br><img src="/gallery/images/shop-mall/service-api/product/login-options.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/login-post.png" alt=""></p>
<h1 id="商品服务-API-三级分类-查询-树形展示三级分类数据"><a href="#商品服务-API-三级分类-查询-树形展示三级分类数据" class="headerlink" title="商品服务-API-三级分类-查询-树形展示三级分类数据"></a>商品服务-API-三级分类-查询-树形展示三级分类数据</h1><p>进入分类维护页面的获取数据请求仍然是404。所以需要在网关服务中添加商品服务的网关路由和路径重写。<br><img src="/gallery/images/shop-mall/service-api/product/get-tree-404-2.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/config-gateway-product.png" alt=""><br>配置之后重启访问发现可以成功获取数据了。<br><img src="/gallery/images/shop-mall/service-api/product/get-tree-200.png" alt=""><br>修改前端代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree :data=<span class="string">"menus"</span> :props=<span class="string">"defaultProps"</span> @node-click=<span class="string">"handleNodeClick"</span>&gt;&lt;<span class="regexp">/el-tree&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      menus: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: <span class="string">"children"</span>,</span><br><span class="line">        label: <span class="string">"name"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleNodeClick(data) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">        url: <span class="keyword">this</span>.$http.adornUrl(<span class="string">"/product/category/list/tree"</span>),</span><br><span class="line">        method: <span class="string">"get"</span></span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">&#123;data&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"成功获取到菜单数据..."</span>,data.data)</span><br><span class="line">          <span class="keyword">this</span>.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">      <span class="keyword">this</span>.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;style lang='scss' scoped&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure>
<p>效果展示：<br><img src="/gallery/images/shop-mall/service-api/product/product-category.png" alt=""></p>
<h1 id="商品服务-API-三级分类-删除-页面效果"><a href="#商品服务-API-三级分类-删除-页面效果" class="headerlink" title="商品服务-API-三级分类-删除-页面效果"></a>商品服务-API-三级分类-删除-页面效果</h1><p>使用 scoped slot。<br><img src="/gallery/images/shop-mall/service-api/product/element-ui-component-tree.png" alt=""><br>没有子菜单可以删除，一级、二级菜单可以添加。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree :data=<span class="string">"menus"</span> :props=<span class="string">"defaultProps"</span> @node-click=<span class="string">"handleNodeClick"</span> :expand-on-click-node=<span class="string">"false"</span> show-checkbox node-key=<span class="string">"catId"</span>&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"custom-tree-node"</span> slot-scope=<span class="string">"&#123; node, data &#125;"</span>&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;el-button v-if="node.level&lt;=2" type="text" size="mini" @click="() =&gt; append(data)"&gt;Append&lt;/</span>el-button&gt;</span><br><span class="line">        &lt;el-button v-<span class="keyword">if</span>=<span class="string">"node.childNodes.length==0"</span> type=<span class="string">"text"</span> size=<span class="string">"mini"</span> @click=<span class="string">"() =&gt; remove(node, data)"</span>&gt;Delete&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>el-tree&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  components: &#123;&#125;,</span></span><br><span class="line"><span class="regexp">  data() &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      menus: [],</span></span><br><span class="line"><span class="regexp">      defaultProps: &#123;</span></span><br><span class="line"><span class="regexp">        children: "children",</span></span><br><span class="line"><span class="regexp">        label: "name"</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    handleNodeClick(data) &#123;</span></span><br><span class="line"><span class="regexp">      console.log(data);</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    getMenus() &#123;</span></span><br><span class="line"><span class="regexp">      this.$http(&#123;</span></span><br><span class="line"><span class="regexp">        url: this.$http.adornUrl("/</span>product/category/list/tree<span class="string">"),</span></span><br><span class="line"><span class="string">        method: "</span><span class="keyword">get</span>"</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"成功获取到菜单数据..."</span>, data.data);</span><br><span class="line">        <span class="keyword">this</span>.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"append"</span>, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"remove"</span>, node, data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="keyword">this</span>.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;style lang='scss' scoped&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/gallery/images/shop-mall/service-api/product/product-category-delete-append.png" alt=""></p>
<h1 id="商品服务-API-三级分类-删除-逻辑删除"><a href="#商品服务-API-三级分类-删除-逻辑删除" class="headerlink" title="商品服务-API-三级分类-删除-逻辑删除"></a>商品服务-API-三级分类-删除-逻辑删除</h1><p>下载安装Postman <a href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a><br>测试删除接口。<br><img src="/gallery/images/shop-mall/service-api/product/post-man.png" alt=""></p>
<p>使用mybatis逻辑删除。<br><img src="/gallery/images/shop-mall/service-api/product/mybatis-plus-logic-delete.png" alt=""></p>
<h1 id="商品服务-API-三级分类-删除-逻辑删除-1"><a href="#商品服务-API-三级分类-删除-逻辑删除-1" class="headerlink" title="商品服务-API-三级分类-删除-逻辑删除"></a>商品服务-API-三级分类-删除-逻辑删除</h1><h1 id="商品服务-API-三级分类-删除-删除效果细化"><a href="#商品服务-API-三级分类-删除-删除效果细化" class="headerlink" title="商品服务-API-三级分类-删除-删除效果细化"></a>商品服务-API-三级分类-删除-删除效果细化</h1><h1 id="商品服务-API-三级分类-新增-新增效果完成"><a href="#商品服务-API-三级分类-新增-新增效果完成" class="headerlink" title="商品服务-API-三级分类-新增-新增效果完成"></a>商品服务-API-三级分类-新增-新增效果完成</h1><h1 id="商品服务-API-三级分类-修改-基本修改效果完成"><a href="#商品服务-API-三级分类-修改-基本修改效果完成" class="headerlink" title="商品服务-API-三级分类-修改-基本修改效果完成"></a>商品服务-API-三级分类-修改-基本修改效果完成</h1><h1 id="商品服务-API-三级分类-修改-拖拽效果"><a href="#商品服务-API-三级分类-修改-拖拽效果" class="headerlink" title="商品服务-API-三级分类-修改-拖拽效果"></a>商品服务-API-三级分类-修改-拖拽效果</h1><h1 id="商品服务-API-三级分类-修改-拖拽数据收集"><a href="#商品服务-API-三级分类-修改-拖拽数据收集" class="headerlink" title="商品服务-API-三级分类-修改-拖拽数据收集"></a>商品服务-API-三级分类-修改-拖拽数据收集</h1><h1 id="商品服务-API-三级分类-修改-拖拽功能完成"><a href="#商品服务-API-三级分类-修改-拖拽功能完成" class="headerlink" title="商品服务-API-三级分类-修改-拖拽功能完成"></a>商品服务-API-三级分类-修改-拖拽功能完成</h1><h1 id="商品服务-API-三级分类-修改-批量拖拽效果"><a href="#商品服务-API-三级分类-修改-批量拖拽效果" class="headerlink" title="商品服务-API-三级分类-修改-批量拖拽效果"></a>商品服务-API-三级分类-修改-批量拖拽效果</h1><h1 id="商品服务-API-三级分类-删除-批量删除-amp-小结"><a href="#商品服务-API-三级分类-删除-批量删除-amp-小结" class="headerlink" title="商品服务-API-三级分类-删除-批量删除&amp;小结"></a>商品服务-API-三级分类-删除-批量删除&amp;小结</h1><h1 id="商品服务-API-品牌管理-使用逆向工程的前后端代码"><a href="#商品服务-API-品牌管理-使用逆向工程的前后端代码" class="headerlink" title="商品服务-API-品牌管理-使用逆向工程的前后端代码"></a>商品服务-API-品牌管理-使用逆向工程的前后端代码</h1><h1 id="商品服务-API-品牌管理-效果优化与快速显示开关"><a href="#商品服务-API-品牌管理-效果优化与快速显示开关" class="headerlink" title="商品服务-API-品牌管理-效果优化与快速显示开关"></a>商品服务-API-品牌管理-效果优化与快速显示开关</h1><h1 id="商品服务-API-品牌管理-云存储开通与使用"><a href="#商品服务-API-品牌管理-云存储开通与使用" class="headerlink" title="商品服务-API-品牌管理-云存储开通与使用"></a>商品服务-API-品牌管理-云存储开通与使用</h1><p><img src="/gallery/images/shop-mall/service-api/product/file-store.png" alt=""><br><a href="/springcloud-distributed-components.html#SpringCloud-Alibaba-OSS">SpringCloud-Alibaba-OSS</a></p>
<p>简介<br>对象存储服务(Object Storage Service,OSS)是一种海量、安全、低成本、高可靠的云存储服务，适合存放任意类型的文件。容量和处理能力弹性扩展，多钟存储类型供选择，全面优化存储成本。</p>
<p>这个是对象存储的页面。<br><img src="/gallery/images/shop-mall/service-api/product/oss-aliyun.png" alt=""><br>推荐一个项目创建一个Bucket。上传一张图片就可以外网访问。<br><img src="/gallery/images/shop-mall/service-api/product/bucket.png" alt=""><br>普通上传方式<br><img src="/gallery/images/shop-mall/service-api/product/oss-common.png" alt=""><br>服务端签名后直传<br><img src="/gallery/images/shop-mall/service-api/product/oss-sign.png" alt=""></p>
<h1 id="商品服务-API-品牌管理-OSS整合测试"><a href="#商品服务-API-品牌管理-OSS整合测试" class="headerlink" title="商品服务-API-品牌管理-OSS整合测试"></a>商品服务-API-品牌管理-OSS整合测试</h1><p>使用代码给阿里云OSS中的zheli-mall上传图片。<br><img src="/gallery/images/shop-mall/service-api/product/use-java-sdk.png" alt=""><br>阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 <a href="https://ram.console.aliyun.com">https://ram.console.aliyun.com</a> 创建RAM账号。<br>创建子AccessKey并设置权限。<br><img src="/gallery/images/shop-mall/service-api/product/aliyun-oss-full-acess.png" alt=""></p>
<p>首先我们创建一个工程，这个工程专门用来集成第三方应用的工程，我起名叫zhelimall-third-party。<br>1.在pom文件中加入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--阿里云存储--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.配置key,endpoint相关信息</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> <span class="string">LTAI4GAGUKKkE4agXXXXXXxX</span></span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">ggruUCv4r9juD8QkmBXXXXXxxXXXX</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br><span class="line">        <span class="attr">bucket:</span> <span class="string">zheli-mall</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">zheli-third-party</span></span><br></pre></td></tr></table></figure>
<p>3.使用OSSClient 进行相关操作</p>
<h1 id="商品服务-API-品牌管理-OSS获取服务端签名"><a href="#商品服务-API-品牌管理-OSS获取服务端签名" class="headerlink" title="商品服务-API-品牌管理-OSS获取服务端签名"></a>商品服务-API-品牌管理-OSS获取服务端签名</h1><p><img src="/gallery/images/shop-mall/service-api/product/server-sign-oss-doc.png" alt=""></p>
<p>编写代码：OssController.java<br>配置网关：<br><a href="http://localhost:30000/oss/policy">http://localhost:30000/oss/policy</a><br><a href="http://localhost:88/api/thirdparty/oss/policy">http://localhost:88/api/thirdparty/oss/policy</a></p>
<h1 id="商品服务-API-品牌管理-OSS前后联调测试上传"><a href="#商品服务-API-品牌管理-OSS前后联调测试上传" class="headerlink" title="商品服务-API-品牌管理-OSS前后联调测试上传"></a>商品服务-API-品牌管理-OSS前后联调测试上传</h1><p>Element-UI中的<el-upload/></p>
<h1 id="商品服务-API-品牌管理-表单校验-amp-自定义校验器"><a href="#商品服务-API-品牌管理-表单校验-amp-自定义校验器" class="headerlink" title="商品服务-API-品牌管理-表单校验&amp;自定义校验器"></a>商品服务-API-品牌管理-表单校验&amp;自定义校验器</h1><p>前端校验方法<br><img src="/gallery/images/shop-mall/service-api/product/show-image.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/jiaoyan.png" alt=""></p>
<h1 id="商品服务-API-品牌管理-JSR303数据校验"><a href="#商品服务-API-品牌管理-JSR303数据校验" class="headerlink" title="商品服务-API-品牌管理-JSR303数据校验"></a>商品服务-API-品牌管理-JSR303数据校验</h1><p>后端校验方法<br>BrandEntity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 三.JSR303</span></span><br><span class="line"><span class="comment"> *  (一).给Bean添加校验注解 <span class="doctag">@Email</span> <span class="doctag">@NotNull</span>在javax.validation.constraints包下</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@NotBlank</span></span></span><br><span class="line"><span class="comment"> *      private String name;</span></span><br><span class="line"><span class="comment"> *  (二).开启校验功能<span class="doctag">@Valid</span></span></span><br><span class="line"><span class="comment"> *      public R save(<span class="doctag">@Valid</span> <span class="doctag">@RequestBody</span> BrandEntity brand)</span></span><br><span class="line"><span class="comment"> *      效果：校验错误以后会有默认的响应；</span></span><br><span class="line"><span class="comment"> *  (三).给校验的Bean后紧跟一个BindingResult,就可以获取到校验的结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"pms_brand"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull</span>(message = <span class="string">"修改必须指定品牌id"</span>)</span><br><span class="line">	<span class="meta">@Null</span>(message = <span class="string">"新增不能指定id"</span>)</span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line">	<span class="keyword">private</span> Long brandId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank</span>(message = <span class="string">"品牌名必须提交"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌logo地址</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank</span></span><br><span class="line">	<span class="meta">@URL</span>(message = <span class="string">"logo必须是一个合法的url地址"</span>)</span><br><span class="line">	<span class="keyword">private</span> String logo;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 介绍</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String descript;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="comment">//@ListValue(vals=&#123;0,1&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer showStatus;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检索首字母</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotEmpty</span></span><br><span class="line">	<span class="meta">@Pattern</span>(regexp = <span class="string">"/^[a-zA-z]$/"</span>,message = <span class="string">"检索首字母必须是一个字母"</span>)</span><br><span class="line">	<span class="keyword">private</span> String firstLetter;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 排序</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="meta">@Min</span>(value = <span class="number">0</span>,message = <span class="string">"排序必须大于等于0"</span>)</span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BrandController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(@Valid @RequestBody BrandEntity brand, BindingResult result)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">		Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		<span class="comment">//1.获取校验的错误结果</span></span><br><span class="line">		result.getFieldErrors().forEach((item) -&gt; &#123;</span><br><span class="line">			<span class="comment">// FileError获取到错误提示</span></span><br><span class="line">			String defaultMessage = item.getDefaultMessage();</span><br><span class="line">			<span class="comment">// 获取错误的属性的名字</span></span><br><span class="line">			String field = item.getField();</span><br><span class="line">			map.put(<span class="string">"field"</span>, defaultMessage);</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="keyword">return</span> R.error(<span class="number">400</span>, <span class="string">"提交的数据不合法"</span>).put(<span class="string">"data"</span>, map);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		brandService.save(brand);</span><br><span class="line">		<span class="keyword">return</span> R.ok();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用PostMan测试。<br><img src="/gallery/images/shop-mall/service-api/product/validation-jsr303.png" alt=""></p>
<h1 id="商品服务-API-品牌管理-统一异常处理"><a href="#商品服务-API-品牌管理-统一异常处理" class="headerlink" title="商品服务-API-品牌管理-统一异常处理"></a>商品服务-API-品牌管理-统一异常处理</h1><blockquote>
<p>@ResponseBody + @ControllerAdvice<br>系统错误码<br>错误码和错误信息定义类<br>1.错误码定义规则为5位数<br>2.前两位表示业务场景,最后三位表示错误码。例如：10001。10：通用。 001：系统未知异常。<br>3.维护错误码后需要维护错误描述，将他们定义为枚举形式。<br>错误码列表：<br>    10：通用<br>        001：参数格式校验<br>    11：商品<br>    12：订单<br>    13：购物车<br>    14：物流</p>
</blockquote>
<p>错误码BizCodeEnum.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BizCodeEnum &#123;</span><br><span class="line">    UNKNOW_EXCEPTION(<span class="number">10000</span>,<span class="string">"系统未知异常"</span>),</span><br><span class="line">    VAILD_EXCEPTION(<span class="number">10001</span>,<span class="string">"参数格式校验失败"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    BizCodeEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>集中处理所有异常ZhelimallExceptionControllerAdvice.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestControllerAdvice</span>(basePackages = <span class="string">"com.aiz.zhelimall.product.controller"</span>)<span class="comment">//相当于@ResponseBody + @ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhelimallExceptionControllerAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = MethodArgumentNotValidException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">R</span> <span class="title">handleVaildException</span>(<span class="title">MethodArgumentNotValidException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        log.error(<span class="string">"数据校验出现问题:&#123;&#125;,异常类型:&#123;&#125;"</span>,e.getMessage(),e.getClass());</span><br><span class="line">        BindingResult bindingResult = e.getBindingResult();</span><br><span class="line">        Map&lt;String,String&gt; errorMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((fieldError -&gt; &#123;</span><br><span class="line">            errorMap.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.VAILD_EXCEPTION.getCode(),BizCodeEnum.VAILD_EXCEPTION.getMsg()).put(<span class="string">"data"</span>,errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Throwable<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">R</span> <span class="title">handleException</span>()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-品牌管理-JSR303分组校验"><a href="#商品服务-API-品牌管理-JSR303分组校验" class="headerlink" title="商品服务-API-品牌管理-JSR303分组校验"></a>商品服务-API-品牌管理-JSR303分组校验</h1><blockquote>
<p>分组校验(多场景的复杂校验)<br>1.@NotBlank(message = “品牌名必须提交”,groups = {AddGroup.class,UpdateGroup.class})<br>给校验注解标注什么情况进行校验<br>2.@Validated(AddGroup.class)<br>3.默认没有指定分组的校验注解@Notblank,在分组校验情况@Validated(AddGroup.class)下不生效,只会在@Validated生效<br>BrandEntity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检索首字母</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotEmpty</span>(groups=&#123;AddGroup<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Pattern</span>(<span class="title">regexp</span></span>=<span class="string">"^[a-zA-Z]$"</span>,message = <span class="string">"检索首字母必须是一个字母"</span>,groups=&#123;AddGroup<span class="class">.<span class="keyword">class</span>,<span class="title">UpdateGroup</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">private</span> <span class="title">String</span> <span class="title">firstLetter</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">update</span><span class="params">(@Validated(UpdateGroup.class)</span>@RequestBody BrandEntity brand) </span>&#123;</span><br><span class="line">	brandService.updateById(brand);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-品牌管理-JSR303自定义校验注解"><a href="#商品服务-API-品牌管理-JSR303自定义校验注解" class="headerlink" title="商品服务-API-品牌管理-JSR303自定义校验注解"></a>商品服务-API-品牌管理-JSR303自定义校验注解</h1><p>导入javax依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>自定义校验<br>(一).编写一个自定义的校验注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint</span>(</span><br><span class="line">        validatedBy = &#123;ListValueConstraintValidator<span class="class">.<span class="keyword">class</span>&#125;//可以指定多个不同的校验器，适配不同类型的校验</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class">@<span class="title">Target</span>(</span>&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "</span>&#123;com.aiz.common.valid.ListValue.message&#125;<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Class&lt;?&gt;[] groups() default &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    int[] vals() default &#123;&#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>配置文件ValidationMessages.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">com.aiz.common.valid.ListValue.message</span> = <span class="string">必须提交指定的值</span></span><br></pre></td></tr></table></figure>

<p>(二).编写一个自定义的校验器 ConstraintValidator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">ListValue</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ListValue constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> val : vals)&#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否校验成功</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 需要校验的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value, ConstraintValidatorContext Context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(三).关联自定义的校验器和自定义的校验注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Constraint(</span><br><span class="line">        validatedBy &#x3D; &#123;ListValueConstraintValidator.class&#125;&#x2F;&#x2F;可以指定多个不同的校验器，适配不同类型的校验</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>使用<br>BrandEntity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotNull</span>(groups = &#123;AddGroup<span class="class">.<span class="keyword">class</span>, <span class="title">UpdateStatusGroup</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ListValue</span>(<span class="title">vals</span></span>=&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,groups = &#123;AddGroup<span class="class">.<span class="keyword">class</span>, <span class="title">UpdateStatusGroup</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">private</span> <span class="title">Integer</span> <span class="title">showStatus</span></span>;</span><br></pre></td></tr></table></figure>
<p>BrandController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/update/status"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">updateStatus</span><span class="params">(@Validated(UpdateStatusGroup.class)</span>@RequestBody BrandEntity brand) </span>&#123;</span><br><span class="line">	brandService.updateById(brand);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>检查前端接口调用。</p>
<h1 id="商品服务-概念-SPU-amp-SKU-amp-规格参数-amp-销售属性"><a href="#商品服务-概念-SPU-amp-SKU-amp-规格参数-amp-销售属性" class="headerlink" title="商品服务-概念-SPU&amp;SKU&amp;规格参数&amp;销售属性"></a>商品服务-概念-SPU&amp;SKU&amp;规格参数&amp;销售属性</h1><h2 id="SPU和SKU"><a href="#SPU和SKU" class="headerlink" title="SPU和SKU"></a>SPU和SKU</h2><p>SPU：Standard Product Unit(标准化产品单元)<br>是商品信息聚合的最小单元，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。<br>SKU：Stock Keeping Unit(库存量单元)<br>即库存进出计量的基本单元，可以是以件、盒、托盘等为单位。SKU这对大型连锁超市DC(配送中心)物流管理的一个必要的方法。现在已经被引申为产品统一编号的简称，每种产品均对应有唯一的SKU号。<br>ex：iphone12是SPU、MI10的SPU<br>    iphone12 64G 黑曜石 是SKU<br>    MI10+64G+黑色 是SKU</p>
<h2 id="基本属性【规格参数】与销售属性"><a href="#基本属性【规格参数】与销售属性" class="headerlink" title="基本属性【规格参数】与销售属性"></a>基本属性【规格参数】与销售属性</h2><p>每个分类下的商品共享规格参数，与销售属性。只是有些商品不一定要用这个分类下全部属性。</p>
<ul>
<li>属性是以三级分类组织起来的</li>
<li>规格参数中有些是可以提供检索的</li>
<li>规格参数也是基本属性，他们具有自己的价值</li>
<li>属性的分组也是以三级分类组织起来的</li>
<li>属性名确定的，但是值是每一个商品不同来决定的</li>
</ul>
<p><img src="/gallery/images/shop-mall/service-api/product/attr-group.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/spu-sku-attr.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/spu-sku-attr-table.png" alt=""><br><img src="/gallery/images/shop-mall/service-api/product/attr-group-effect.png" alt=""></p>
<h1 id="商品服务-API-属性分组-前端组件抽取-amp-父子组件交互"><a href="#商品服务-API-属性分组-前端组件抽取-amp-父子组件交互" class="headerlink" title="商品服务-API-属性分组-前端组件抽取&amp;父子组件交互"></a>商品服务-API-属性分组-前端组件抽取&amp;父子组件交互</h1><blockquote>
<p>父子组件传递数据<br>子组件给父组件传递数据，事件机制。子组件给父组件发送一个事件，携带上数据。<br>this.$emit(“事件名称”, 需要携带的数据…);</p>
</blockquote>
<p>抽取子组件<code>../common/category.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">el-tree</span> <span class="attr">:data</span>=<span class="string">"menus"</span> <span class="attr">:props</span>=<span class="string">"defaultProps"</span> <span class="attr">node-key</span>=<span class="string">"catId"</span> <span class="attr">ref</span>=<span class="string">"menuTree"</span> @<span class="attr">node-click</span>=<span class="string">"nodeclick"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-tree</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line"><span class="actionscript">        children: <span class="string">"children"</span>,</span></span><br><span class="line"><span class="actionscript">        label: <span class="string">"name"</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="actionscript">    <span class="comment">//共三个参数，依次为：传递给 data 属性的数组中该节点所对应的对象、节点对应的 Node、节点组件本身。</span></span></span><br><span class="line">    nodeclick(data, node, component) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"子组件category的节点被点击"</span>, data, node, component);</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//向父组件发送事件；</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$emit(<span class="string">"tree-node-click"</span>, data, node, component);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>父组件<code>/product/attrgroup.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> @<span class="attr">tree-node-click</span>=<span class="string">"treenodeclick"</span>&gt;</span><span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Category <span class="keyword">from</span> <span class="string">"../common/category"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">	methods: &#123;</span><br><span class="line"><span class="actionscript">		<span class="comment">//感知树节点被点击</span></span></span><br><span class="line">		treenodeclick(data, node, component) &#123;</span><br><span class="line"><span class="javascript">		  <span class="built_in">console</span>.log(<span class="string">"attrgroup感知到category的节点被点击"</span>,data, node, component);</span></span><br><span class="line"><span class="javascript">		  <span class="built_in">console</span>.log(<span class="string">"刚才被点击的菜单id："</span>,data.catId);</span></span><br><span class="line">		  if (node.level == 3) &#123;</span><br><span class="line"><span class="actionscript">			<span class="keyword">this</span>.catId = data.catId;</span></span><br><span class="line"><span class="actionscript">			<span class="keyword">this</span>.getDataList(); <span class="comment">//重新查询</span></span></span><br><span class="line">		  &#125;</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-属性分组-获取分类属性分组"><a href="#商品服务-API-属性分组-获取分类属性分组" class="headerlink" title="商品服务-API-属性分组-获取分类属性分组"></a>商品服务-API-属性分组-获取分类属性分组</h1><p>接口文档：<a href="https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd">https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd</a></p>
<p>AttrGroupController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/list/&#123;catelogId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(@RequestParam Map&lt;String, Object&gt; params,</span></span></span><br><span class="line"><span class="function"><span class="params">			  @PathVariable(<span class="string">"catelogId"</span>)</span> Long catelogId)</span>&#123;</span><br><span class="line">	PageUtils page = attrGroupService.queryPage(params,catelogId);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> R.ok().put(<span class="string">"page"</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrGroupServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (catelogId == <span class="number">0</span>) &#123;</span><br><span class="line">		IPage&lt;AttrGroupEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">				<span class="keyword">new</span> Query&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">				<span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;()</span><br><span class="line">		);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		String key = (String) params.get(<span class="string">"key"</span>);</span><br><span class="line">		<span class="comment">//select * from pms_attr_group where catelog_id = ? and (attr_group_id = key or attr_group_name like '%key%')</span></span><br><span class="line">		QueryWrapper&lt;AttrGroupEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">"catelog_id"</span>, catelogId);</span><br><span class="line">		<span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			wrapper.and((obj) -&gt; &#123;</span><br><span class="line">				obj.eq(<span class="string">"attr_group_id"</span>, key).or().like(<span class="string">"attr_group_name"</span>, key);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		IPage&lt;AttrGroupEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">				<span class="keyword">new</span> Query&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">				wrapper</span><br><span class="line">		);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/gallery/images/shop-mall/service-api/product/show-attrgroup.png" alt=""></p>
<h1 id="商品服务-API-属性分组-分组新增-amp-级联选择器"><a href="#商品服务-API-属性分组-分组新增-amp-级联选择器" class="headerlink" title="商品服务-API-属性分组-分组新增&amp;级联选择器"></a>商品服务-API-属性分组-分组新增&amp;级联选择器</h1><h1 id="商品服务-API-属性分组-分组修改-amp-级联选择器回显"><a href="#商品服务-API-属性分组-分组修改-amp-级联选择器回显" class="headerlink" title="商品服务-API-属性分组-分组修改&amp;级联选择器回显"></a>商品服务-API-属性分组-分组修改&amp;级联选择器回显</h1><p>Element-UI中Cascader级联选择器的使用<br><img src="/gallery/images/shop-mall/service-api/product/product-attrgroup-add.png" alt=""></p>
<h1 id="商品服务-API-品牌管理-品牌分类关联与级联更新"><a href="#商品服务-API-品牌管理-品牌分类关联与级联更新" class="headerlink" title="商品服务-API-品牌管理-品牌分类关联与级联更新"></a>商品服务-API-品牌管理-品牌分类关联与级联更新</h1><p>MyBatis Plus分页插件使用 <a href="https://mp.baomidou.com/guide/page.html">https://mp.baomidou.com/guide/page.html</a><br>com.aiz.zhelimall.product.config.MyBatisConfig.java</p>
<p>一个品牌会有多个分类，一个分类也会包含多个品牌。分类&amp;品牌是多对多的关系。<br><img src="/gallery/images/shop-mall/service-api/product/db-category-brand-relation.png" alt=""></p>
<p>查询接口：product/categorybrandrelation/catelog/list?brandId=4<br>添加接口：product/categorybrandrelation/save<br>在电商系统中对于大表尽量避免关联查询，所以这边存放brand_name和catelog_name冗余字段。<br><img src="/gallery/images/shop-mall/service-api/product/show-category-brand-relation.png" alt=""><br>因为有冗余字段设计，所以在业务代码中修改品牌名称还需要同时修改关联表中的字段。</p>
<h2 id="使用QueryWrapper方式："><a href="#使用QueryWrapper方式：" class="headerlink" title="使用QueryWrapper方式："></a>使用QueryWrapper方式：</h2><p>BrandController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">update</span><span class="params">(@Validated(UpdateGroup.class)</span>@RequestBody BrandEntity brand) </span>&#123;</span><br><span class="line">	<span class="comment">//brandService.updateById(brand);</span></span><br><span class="line">	<span class="comment">//这里不能只更新品牌表 因为其他表包含品牌表里面的字段(字段冗余设计造成的)</span></span><br><span class="line">	brandService.updateDetail(brand);</span><br><span class="line">	<span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BrandServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDetail</span><span class="params">(BrandEntity brand)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//保证冗余字段的数据一致</span></span><br><span class="line">	<span class="keyword">this</span>.updateById(brand);</span><br><span class="line">	<span class="keyword">if</span>(!StringUtils.isEmpty(brand.getName()))&#123;</span><br><span class="line">		<span class="comment">//同步更新其他关联表中的数据</span></span><br><span class="line">		categoryBrandRelationService.updateBrand(brand.getBrandId(),brand.getName());</span><br><span class="line">		<span class="comment">// TODO 更新其他关联</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CategoryBrandRelationServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBrand</span><span class="params">(Long brandId, String name)</span> </span>&#123;</span><br><span class="line">	CategoryBrandRelationEntity relationEntity = <span class="keyword">new</span> CategoryBrandRelationEntity();</span><br><span class="line">	relationEntity.setBrandId(brandId);</span><br><span class="line">	relationEntity.setBrandName(name);</span><br><span class="line">	<span class="keyword">this</span>.update(relationEntity,<span class="keyword">new</span> UpdateWrapper&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">"brand_id"</span>,brandId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用自定义SQL语句方式："><a href="#使用自定义SQL语句方式：" class="headerlink" title="使用自定义SQL语句方式："></a>使用自定义SQL语句方式：</h2><p>CategoryController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">update</span><span class="params">(@RequestBody CategoryEntity category)</span></span>&#123;</span><br><span class="line">	categoryService.updateCascade(category);</span><br><span class="line">	<span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CategoryServiceImpl.java 这里包含事务控制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联更新所有关联的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCascade</span><span class="params">(CategoryEntity category)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.updateById(category);</span><br><span class="line">	categoryBrandRelationService.updateCategory(category.getCatId(),category.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CategoryBrandRelationDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateCategory</span><span class="params">(@Param(<span class="string">"catId"</span>)</span> Long catId, @<span class="title">Param</span><span class="params">(<span class="string">"name"</span>)</span> String name)</span>;</span><br></pre></td></tr></table></figure>
<p>CategoryBrandRelationDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateCategory"</span>&gt;</span></span><br><span class="line">	UPDATE `pms_category_brand_relation` SET catelog_name=#&#123;name&#125; WHERE catelog_id=#&#123;catId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-平台属性-规格参数新增与VO"><a href="#商品服务-API-平台属性-规格参数新增与VO" class="headerlink" title="商品服务-API-平台属性-规格参数新增与VO"></a>商品服务-API-平台属性-规格参数新增与VO</h1><h2 id="Object划分"><a href="#Object划分" class="headerlink" title="Object划分"></a>Object划分</h2><ul>
<li>PO(Persistant Object)持久对象<br>PO就是对应数据库中某个表中的一条记录，多个记录可以用PO的集合。PO中应该不包含任何对数据库的操作。</li>
<li>DO(Domain Object)领域对象<br>就是从现实世界中抽象出来的有形或无形的业务实体。</li>
<li>TO(Transfer Object)数据传输对象<br>不同应用程序之间传输的对象。</li>
<li>DTO(Data Transfer Object)数据传输对象<br>这个概念来源于J2EE的设计模式，原来的目的是为了EJB的分布式应用提供粗颗粒度的数据实体，以减少分布式调用的次数,从而提高分布式调用的性能和降低网络负载，但在这里，泛指用于展示层与服务层之间的数据传输对象。</li>
<li>VO(Value Object)值对象<br>通常用于业务层之间的数据传递，和PO一样也是仅仅包含数据而已。但应是抽象出的业务对象，可以和表对应，也可以不。这根据业务的需要。用new关键字创建，由GC回收的。<br>View Object：视图对象。接收页面传递来的数据，封装对象。将业务处理完的对象封装成页面要用的数据。</li>
<li>BO(Business Object)业务对象<br>从业务模型的角度看，见UML元件领域模型中的领域对象。封装业务逻辑的Java对象，通过调用DAO方法，结合PO/VO进行业务操作。business object：业务对象 主要作用是把业务逻辑封装为一个对象。这个对象可以包括一个或多个其他的对象。比如一个简历，有教育经历、工作经历、社会关系等等。我们可以把教育经历对应一个PO，工作经历对应一个PO，社会关系对应一个PO。建立一个对应简历的BO对象处理简历，每个BO包含这些PO。这样处理业务逻辑时，我们就可以针对BO去处理。</li>
<li>POJO(plain ordinary java object)简单无规则Java对象<br>传统意义的java对象。就是说在一些Object/Relation Mapping工具中，能够做到维护数据库表记录的persisent object完全是一个符合Java Bean规范的纯Java对象，没有增加别的属性和方法。我的理解就是最基本的Java Bean，只有属性字段以及setter和getter方法。<br>POJO是DO/DTO/BO/VO的统称。</li>
<li>DAO(Data Accsee Object)数据访问对象<br>是一个sun的一个标准j2ee设计模式，这个模式中有个接口就是DAO，它负责持久层的操作。为业务层通过接口。此对象用于访问数据库。通过和PO结合使用，DAO中包含了各种数据库的操作方法。通过它的方法，结合PO对数据库进行相关的操作。夹在业务逻辑与数据库资源终究，配合VO，提供数据库的CRUD操作。</li>
</ul>
<h2 id="规格参数新增"><a href="#规格参数新增" class="headerlink" title="规格参数新增"></a>规格参数新增</h2><p>因为在接受页面传来的属性数据的时候，会把属性的分组信息也带过来。所以新建AttrVo.java用于存放属性信息和属性分组attrGroupId信息。<br>AttrVo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否需要检索[0-不需要，1-需要]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer searchType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可选值列表[用逗号分隔]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String valueSelect;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性类型[0-销售属性，1-基本属性，2-既是销售属性又是基本属性]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer attrType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用状态[0 - 禁用，1 - 启用]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long enable;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 快速展示【是否展示在介绍上；0-否 1-是】，在sku中仍然可以调整</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showDesc;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性分组id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面提交信息时，会涉及到属性信息和属性分组信息两张数据库表。<br>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(@RequestBody AttrVo attr)</span></span>&#123;</span><br><span class="line">	attrService.saveAttr(attr);</span><br><span class="line">	<span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrServiceImpl.java在给attrEntity设置属性值的时候，可以(1).一个一个set。(2).使用spring的BeanUtils.copyProperties()，需要注意的是这个浅拷贝，也就是说如果存在子对象且子对象还需要改变就一定不能使用这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrVo attr)</span> </span>&#123;</span><br><span class="line">	AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line"><span class="comment">//        attrEntity.setAttrName(attr.getAttrName());</span></span><br><span class="line"><span class="comment">//        ...</span></span><br><span class="line">	BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">	<span class="comment">//1.保存基本数据</span></span><br><span class="line">	<span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">	<span class="comment">//2.保存关联关系</span></span><br><span class="line">	AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">	relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">	relationEntity.setAttrId(attrEntity.getAttrId());</span><br><span class="line">	relationDao.insert(relationEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果。<br><img src="/gallery/images/shop-mall/service-api/product/add-base-attr.png" alt=""><br>属性表<br><img src="/gallery/images/shop-mall/service-api/product/db-pms-attr.png" alt=""><br>属性分组关系表<br><img src="/gallery/images/shop-mall/service-api/product/db-pms-attr-attrgroup-relation.png" alt=""></p>
<h1 id="商品服务-API-平台属性-规格参数列表"><a href="#商品服务-API-平台属性-规格参数列表" class="headerlink" title="商品服务-API-平台属性-规格参数列表"></a>商品服务-API-平台属性-规格参数列表</h1><p><img src="/gallery/images/shop-mall/service-api/product/show-product-base-attr.png" alt=""><br>这个页面展示的是属性相关信息，数据来源于【属性表pms_attr】。但是【属性表pms_attr】中并没有【所属分类】和【所属分组】的信息。(1).【属性表pms_attr】中有【分类ID:catelog_id】，就是拿到分类ID再去分类表找到分类名称。(2).需要从【属性&amp;属性分组表pms_attr_attrgroup_relation】中获取【分组ID】【分组名称attr_group_name】。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> attr.*,category.<span class="string">`name`</span> <span class="keyword">as</span> category_name,attr_group.attr_group_name <span class="keyword">as</span> group_name</span><br><span class="line"><span class="keyword">from</span> pms_attr <span class="keyword">attr</span></span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> pms_category <span class="keyword">category</span> <span class="keyword">on</span> attr.catelog_id=category.cat_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> pms_attr_attrgroup_relation relation <span class="keyword">on</span> relation.attr_id=attr.attr_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> pms_attr_group attr_group <span class="keyword">on</span> relation.attr_group_id = attr_group.attr_group_id;</span><br></pre></td></tr></table></figure>

<p>新建响应数据AttrRespVo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrRespVo</span> <span class="keyword">extends</span> <span class="title">AttrVo</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分组名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/base/list/&#123;catelogId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">baseAttrList</span><span class="params">(@RequestParam Map&lt;String, Object&gt; params,</span></span></span><br><span class="line"><span class="function"><span class="params">					  @PathVariable(<span class="string">"catelogId"</span>)</span> Long catelogId)</span>&#123;</span><br><span class="line">	PageUtils page = attrService.queryBaseAttrPage(params,catelogId);</span><br><span class="line">	<span class="keyword">return</span> R.ok().put(<span class="string">"page"</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> </span>&#123;</span><br><span class="line">	QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">	<span class="keyword">if</span>(catelogId!=<span class="number">0</span>)&#123;</span><br><span class="line">		queryWrapper.eq(<span class="string">"catelog_id"</span>,catelogId);</span><br><span class="line">	&#125;</span><br><span class="line">	String key = (String) params.get(<span class="string">"key"</span>);</span><br><span class="line">	<span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">		<span class="comment">//attr_id attr_name</span></span><br><span class="line">		queryWrapper.and((wrapper)-&gt;&#123;</span><br><span class="line">			wrapper.eq(<span class="string">"attr_id"</span>,key).or().like(<span class="string">"attr_name"</span>,key);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	IPage&lt;AttrEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">			<span class="keyword">new</span> Query&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">			queryWrapper</span><br><span class="line">	);</span><br><span class="line">	PageUtils pageUtils = <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">	List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">	List&lt;AttrRespVo&gt; attrRespVos = records.stream().map(attrEntity -&gt; &#123;</span><br><span class="line">		AttrRespVo attrRespVo = <span class="keyword">new</span> AttrRespVo();</span><br><span class="line">		BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line">		<span class="comment">//设置分类和分组的名字</span></span><br><span class="line">		AttrAttrgroupRelationEntity attrId = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">"attr_id"</span>, attrEntity.getAttrId()));</span><br><span class="line">		<span class="keyword">if</span> (attrId != <span class="keyword">null</span>) &#123;</span><br><span class="line">			AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrId.getAttrGroupId());</span><br><span class="line">			attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">		&#125;</span><br><span class="line">		CategoryEntity categoryEntity = categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">		<span class="keyword">if</span> (categoryEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">			attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> attrRespVo;</span><br><span class="line">	&#125;).collect(Collectors.toList());</span><br><span class="line">	pageUtils.setList(attrRespVos);</span><br><span class="line">	<span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="商品服务-API-平台属性-规格修改"><a href="#商品服务-API-平台属性-规格修改" class="headerlink" title="商品服务-API-平台属性-规格修改"></a>商品服务-API-平台属性-规格修改</h1><p><img src="/gallery/images/shop-mall/service-api/product/show-product-base-attr-category-group.png" alt=""><br>在回显数据的时候三级分类路径缺少。所以在AttrRespVo中添加属性catelogPath。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrRespVo</span> <span class="keyword">extends</span> <span class="title">AttrVo</span></span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">private</span> Long[] catelogPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/info/&#123;attrId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">info</span><span class="params">(@PathVariable(<span class="string">"attrId"</span>)</span> Long attrId)</span>&#123;</span><br><span class="line">	AttrVo attrVo = attrService.getAttrInfo(attrId);</span><br><span class="line">	<span class="keyword">return</span> R.ok().put(<span class="string">"attr"</span>, attrVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AttrVo <span class="title">getAttrInfo</span><span class="params">(Long attrId)</span> </span>&#123;</span><br><span class="line">	AttrRespVo attrRespVo = <span class="keyword">new</span> AttrRespVo();</span><br><span class="line">	AttrEntity attrEntity = <span class="keyword">this</span>.getById(attrId);</span><br><span class="line">	BeanUtils.copyProperties(attrEntity,attrRespVo);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode())&#123;</span><br><span class="line">		<span class="comment">//1.设置分组信息</span></span><br><span class="line">		AttrAttrgroupRelationEntity attrgroupRelation = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">"attr_id"</span>, attrEntity.getAttrId()));</span><br><span class="line">		<span class="keyword">if</span>(attrgroupRelation!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			attrRespVo.setAttrGroupId(attrgroupRelation.getAttrGroupId());</span><br><span class="line">			AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrgroupRelation.getAttrGroupId());</span><br><span class="line">			<span class="keyword">if</span>(attrGroupEntity!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//2.设置分类信息</span></span><br><span class="line">	Long catelogId = attrEntity.getCatelogId();</span><br><span class="line">	Long[] catelogPath = categoryService.findCatelogPath(catelogId);</span><br><span class="line">	attrRespVo.setCatelogPath(catelogPath);</span><br><span class="line">	CategoryEntity categoryEntity = categoryDao.selectById(catelogId);</span><br><span class="line">	<span class="keyword">if</span>(categoryEntity!=<span class="keyword">null</span>)&#123;</span><br><span class="line">		attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> attrRespVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="商品服务-API-平台属性-销售属性维护"><a href="#商品服务-API-平台属性-销售属性维护" class="headerlink" title="商品服务-API-平台属性-销售属性维护"></a>商品服务-API-平台属性-销售属性维护</h1><p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;attrType&#125;/list/&#123;catelogId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">baseAttrList</span><span class="params">(@RequestParam Map&lt;String, Object&gt; params,</span></span></span><br><span class="line"><span class="function"><span class="params">					  @PathVariable(<span class="string">"catelogId"</span>)</span> Long catelogId,</span></span><br><span class="line"><span class="function">					  @<span class="title">PathVariable</span><span class="params">(<span class="string">"attrType"</span>)</span> String type)</span>&#123;</span><br><span class="line">	PageUtils page = attrService.queryBaseAttrPage(params,catelogId,type);</span><br><span class="line">	<span class="keyword">return</span> R.ok().put(<span class="string">"page"</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-平台属性-查询分组关联属性-amp-删除关联"><a href="#商品服务-API-平台属性-查询分组关联属性-amp-删除关联" class="headerlink" title="商品服务-API-平台属性-查询分组关联属性&amp;删除关联"></a>商品服务-API-平台属性-查询分组关联属性&amp;删除关联</h1><h1 id="商品服务-API-平台属性-查询分组未关联的属性"><a href="#商品服务-API-平台属性-查询分组未关联的属性" class="headerlink" title="商品服务-API-平台属性-查询分组未关联的属性"></a>商品服务-API-平台属性-查询分组未关联的属性</h1><h1 id="商品服务-API-新增商品-调试会员等级相关接口"><a href="#商品服务-API-新增商品-调试会员等级相关接口" class="headerlink" title="商品服务-API-新增商品-调试会员等级相关接口"></a>商品服务-API-新增商品-调试会员等级相关接口</h1><p><img src="/gallery/images/shop-mall/service-api/product/product-attrgroup-crud.png" alt=""></p>
<h1 id="商品服务-API-新增商品-调试会员等级相关接口-1"><a href="#商品服务-API-新增商品-调试会员等级相关接口-1" class="headerlink" title="商品服务-API-新增商品-调试会员等级相关接口"></a>商品服务-API-新增商品-调试会员等级相关接口</h1><p><img src="/gallery/images/shop-mall/service-api/product/member-level.png" alt=""></p>
<h1 id="商品服务-API-新增商品-获取分类关联的品牌"><a href="#商品服务-API-新增商品-获取分类关联的品牌" class="headerlink" title="商品服务-API-新增商品-获取分类关联的品牌"></a>商品服务-API-新增商品-获取分类关联的品牌</h1><h1 id="商品服务-API-新增商品-获取分类下所有分组以及属性"><a href="#商品服务-API-新增商品-获取分类下所有分组以及属性" class="headerlink" title="商品服务-API-新增商品-获取分类下所有分组以及属性"></a>商品服务-API-新增商品-获取分类下所有分组以及属性</h1><h1 id="商品服务-API-新增商品-商品新增vo抽取"><a href="#商品服务-API-新增商品-商品新增vo抽取" class="headerlink" title="商品服务-API-新增商品-商品新增vo抽取"></a>商品服务-API-新增商品-商品新增vo抽取</h1><p>对于前端返回的json,可以使用bejson.com转化为JavaBean。下载代码拷贝到项目对应位置。<br><img src="/gallery/images/shop-mall/service-api/product/json2javapojo.png" alt=""></p>
<h1 id="商品服务-API-新增商品-商品新增业务流程分析"><a href="#商品服务-API-新增商品-商品新增业务流程分析" class="headerlink" title="商品服务-API-新增商品-商品新增业务流程分析"></a>商品服务-API-新增商品-商品新增业务流程分析</h1><p>SpuInfoServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1.保存spu基本信息 pms_spu_info</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.保存spu的描述图片 pms_spu_info_desc</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.保存spu的图片集 pms_sku_images</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.保存spu的规格参数 pms_product_attr_value</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//5.保存spu的积分信息 `zhelimall_sms`.sms_spu_bounds</span></span><br><span class="line">	<span class="comment">//6.保存当前spu对应的sku信息</span></span><br><span class="line">	<span class="comment">//6.1 sku基本信息 pms_sku_info</span></span><br><span class="line">	<span class="comment">//6.2 sku的图片信息 pms_sku_images</span></span><br><span class="line">	<span class="comment">//6.3 sku的销售属性信息 pms_sku_sale_attr_value</span></span><br><span class="line">	<span class="comment">//6.4 sku的优惠信息、满减等信息 `zhelimall_sms`.sms_sku_ladder/sms_sku_full_reduction/sms_member_price</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="商品服务-API-新增商品-保存SPU基本信息"><a href="#商品服务-API-新增商品-保存SPU基本信息" class="headerlink" title="商品服务-API-新增商品-保存SPU基本信息"></a>商品服务-API-新增商品-保存SPU基本信息</h1><h1 id="商品服务-API-新增商品-保存SKU基本信息"><a href="#商品服务-API-新增商品-保存SKU基本信息" class="headerlink" title="商品服务-API-新增商品-保存SKU基本信息"></a>商品服务-API-新增商品-保存SKU基本信息</h1><h1 id="商品服务-API-新增商品-调用远程服务保存优惠等信息"><a href="#商品服务-API-新增商品-调用远程服务保存优惠等信息" class="headerlink" title="商品服务-API-新增商品-调用远程服务保存优惠等信息"></a>商品服务-API-新增商品-调用远程服务保存优惠等信息</h1><p>在远程调用的时候，A服务想要给B服务发送数据，Spring Cloud会把数据封装成json发送过去。所以引申出新的领域模型TO。<br>还因为这个TO对象A服务和B服务都要使用，所以建议把这个TO对象放在common模块中。</p>
<blockquote>
<p>注：Mybatis-Plus会自动插入一个ID到实体类，导致设置的id失效。所以需要在@TableId指定type的类型。<br><a href="https://blog.csdn.net/qq_34208844/article/details/88819467">可参考链接</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">SESSION</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> UNCOMMITTED;</span><br></pre></td></tr></table></figure>
<p>SpuInfoDescEntity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"pms_spu_info_desc"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoDescEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 商品id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@TableId</span>(type = IdType.INPUT)</span><br><span class="line">	<span class="keyword">private</span> Long spuId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 商品介绍</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String decript;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>介绍一下Mybatis-Plus几种生成ID类型枚举类的区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> IdType &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库ID自增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AUTO(<span class="number">0</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该类型为未设置主键类型(将跟随全局)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    NONE(<span class="number">1</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户输入ID</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;该类型可以通过自己注册自动填充插件进行填充&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INPUT(<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 以下3种类型、只有当插入对象ID 为空，才自动填充。 */</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局唯一ID (idWorker)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ID_WORKER(<span class="number">3</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局唯一ID (UUID)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UUID(<span class="number">4</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串全局唯一ID (idWorker 的字符串表示)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ID_WORKER_STR(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> key;</span><br><span class="line"></span><br><span class="line">    IdType(<span class="keyword">int</span> key) &#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="商品服务-API-新增商品-商品保存其他问题处理"><a href="#商品服务-API-新增商品-商品保存其他问题处理" class="headerlink" title="商品服务-API-新增商品-商品保存其他问题处理"></a>商品服务-API-新增商品-商品保存其他问题处理</h1><h1 id="商品服务-API-商品管理-SPU检索"><a href="#商品服务-API-商品管理-SPU检索" class="headerlink" title="商品服务-API-商品管理-SPU检索"></a>商品服务-API-商品管理-SPU检索</h1><blockquote>
<p>Spring配置时间格式</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">jackson:</span></span><br><span class="line">      <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<h1 id="商品服务-API-商品管理-SKU检索"><a href="#商品服务-API-商品管理-SKU检索" class="headerlink" title="商品服务-API-商品管理-SKU检索"></a>商品服务-API-商品管理-SKU检索</h1><h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ShopMall/">ShopMall</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5ef7656a652f9d001303a427&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/gallery/donate/alipay.jpg" alt="支付宝"></span></a><a class="button is-warning donate" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="zhangyao9707@163.com"><input type="hidden" name="currency_code" value="USD"></form><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/gallery/donate/wechat.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/business/report-business-summary.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">后台报表业务开发</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/shop-mall/front-end-knowledge.html"><span class="level-item">四、微服务分布式电商系统--前端开发基础知识&amp;快速入门</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: 'e77626adeb3ec0fab7ce6a6a27dc6408',
            repo: 'aizhangyao.github.io',
            owner: 'aizhangyao',
            clientID: '872c6e0704b3561faaca',
            clientSecret: '218979ed7b4abf1e403c79184e02808978a42558',
            admin: ["aizhangyao"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: 'last',
            
            
            enableHotKey: true
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpg" alt="ZhangYao"></figure><p class="title is-size-4 is-block line-height-inherit">ZhangYao</p><p class="is-size-6 is-block">Java Programmer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">66</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">22</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/aizhangyao" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/aizhangyao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#前言"><span class="mr-2">1</span><span>前言</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-查询-递归树形结构数据获取"><span class="mr-2">2</span><span>商品服务-API-三级分类-查询-递归树形结构数据获取</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-配置网关路由和路径重写"><span class="mr-2">3</span><span>商品服务-API-三级分类-配置网关路由和路径重写</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-网关统一配置跨域"><span class="mr-2">4</span><span>商品服务-API-三级分类-网关统一配置跨域</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-查询-树形展示三级分类数据"><span class="mr-2">5</span><span>商品服务-API-三级分类-查询-树形展示三级分类数据</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-删除-页面效果"><span class="mr-2">6</span><span>商品服务-API-三级分类-删除-页面效果</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-删除-逻辑删除"><span class="mr-2">7</span><span>商品服务-API-三级分类-删除-逻辑删除</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-删除-逻辑删除-1"><span class="mr-2">8</span><span>商品服务-API-三级分类-删除-逻辑删除</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-删除-删除效果细化"><span class="mr-2">9</span><span>商品服务-API-三级分类-删除-删除效果细化</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-新增-新增效果完成"><span class="mr-2">10</span><span>商品服务-API-三级分类-新增-新增效果完成</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-修改-基本修改效果完成"><span class="mr-2">11</span><span>商品服务-API-三级分类-修改-基本修改效果完成</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-修改-拖拽效果"><span class="mr-2">12</span><span>商品服务-API-三级分类-修改-拖拽效果</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-修改-拖拽数据收集"><span class="mr-2">13</span><span>商品服务-API-三级分类-修改-拖拽数据收集</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-修改-拖拽功能完成"><span class="mr-2">14</span><span>商品服务-API-三级分类-修改-拖拽功能完成</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-修改-批量拖拽效果"><span class="mr-2">15</span><span>商品服务-API-三级分类-修改-批量拖拽效果</span></a></li><li><a class="is-flex" href="#商品服务-API-三级分类-删除-批量删除-amp-小结"><span class="mr-2">16</span><span>商品服务-API-三级分类-删除-批量删除&amp;小结</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-使用逆向工程的前后端代码"><span class="mr-2">17</span><span>商品服务-API-品牌管理-使用逆向工程的前后端代码</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-效果优化与快速显示开关"><span class="mr-2">18</span><span>商品服务-API-品牌管理-效果优化与快速显示开关</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-云存储开通与使用"><span class="mr-2">19</span><span>商品服务-API-品牌管理-云存储开通与使用</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-OSS整合测试"><span class="mr-2">20</span><span>商品服务-API-品牌管理-OSS整合测试</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-OSS获取服务端签名"><span class="mr-2">21</span><span>商品服务-API-品牌管理-OSS获取服务端签名</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-OSS前后联调测试上传"><span class="mr-2">22</span><span>商品服务-API-品牌管理-OSS前后联调测试上传</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-表单校验-amp-自定义校验器"><span class="mr-2">23</span><span>商品服务-API-品牌管理-表单校验&amp;自定义校验器</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-JSR303数据校验"><span class="mr-2">24</span><span>商品服务-API-品牌管理-JSR303数据校验</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-统一异常处理"><span class="mr-2">25</span><span>商品服务-API-品牌管理-统一异常处理</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-JSR303分组校验"><span class="mr-2">26</span><span>商品服务-API-品牌管理-JSR303分组校验</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-JSR303自定义校验注解"><span class="mr-2">27</span><span>商品服务-API-品牌管理-JSR303自定义校验注解</span></a></li><li><a class="is-flex" href="#商品服务-概念-SPU-amp-SKU-amp-规格参数-amp-销售属性"><span class="mr-2">28</span><span>商品服务-概念-SPU&amp;SKU&amp;规格参数&amp;销售属性</span></a><ul class="menu-list"><li><a class="is-flex" href="#SPU和SKU"><span class="mr-2">28.1</span><span>SPU和SKU</span></a></li><li><a class="is-flex" href="#基本属性【规格参数】与销售属性"><span class="mr-2">28.2</span><span>基本属性【规格参数】与销售属性</span></a></li></ul></li><li><a class="is-flex" href="#商品服务-API-属性分组-前端组件抽取-amp-父子组件交互"><span class="mr-2">29</span><span>商品服务-API-属性分组-前端组件抽取&amp;父子组件交互</span></a></li><li><a class="is-flex" href="#商品服务-API-属性分组-获取分类属性分组"><span class="mr-2">30</span><span>商品服务-API-属性分组-获取分类属性分组</span></a></li><li><a class="is-flex" href="#商品服务-API-属性分组-分组新增-amp-级联选择器"><span class="mr-2">31</span><span>商品服务-API-属性分组-分组新增&amp;级联选择器</span></a></li><li><a class="is-flex" href="#商品服务-API-属性分组-分组修改-amp-级联选择器回显"><span class="mr-2">32</span><span>商品服务-API-属性分组-分组修改&amp;级联选择器回显</span></a></li><li><a class="is-flex" href="#商品服务-API-品牌管理-品牌分类关联与级联更新"><span class="mr-2">33</span><span>商品服务-API-品牌管理-品牌分类关联与级联更新</span></a><ul class="menu-list"><li><a class="is-flex" href="#使用QueryWrapper方式："><span class="mr-2">33.1</span><span>使用QueryWrapper方式：</span></a></li><li><a class="is-flex" href="#使用自定义SQL语句方式："><span class="mr-2">33.2</span><span>使用自定义SQL语句方式：</span></a></li></ul></li><li><a class="is-flex" href="#商品服务-API-平台属性-规格参数新增与VO"><span class="mr-2">34</span><span>商品服务-API-平台属性-规格参数新增与VO</span></a><ul class="menu-list"><li><a class="is-flex" href="#Object划分"><span class="mr-2">34.1</span><span>Object划分</span></a></li><li><a class="is-flex" href="#规格参数新增"><span class="mr-2">34.2</span><span>规格参数新增</span></a></li></ul></li><li><a class="is-flex" href="#商品服务-API-平台属性-规格参数列表"><span class="mr-2">35</span><span>商品服务-API-平台属性-规格参数列表</span></a></li><li><a class="is-flex" href="#商品服务-API-平台属性-规格修改"><span class="mr-2">36</span><span>商品服务-API-平台属性-规格修改</span></a></li><li><a class="is-flex" href="#商品服务-API-平台属性-销售属性维护"><span class="mr-2">37</span><span>商品服务-API-平台属性-销售属性维护</span></a></li><li><a class="is-flex" href="#商品服务-API-平台属性-查询分组关联属性-amp-删除关联"><span class="mr-2">38</span><span>商品服务-API-平台属性-查询分组关联属性&amp;删除关联</span></a></li><li><a class="is-flex" href="#商品服务-API-平台属性-查询分组未关联的属性"><span class="mr-2">39</span><span>商品服务-API-平台属性-查询分组未关联的属性</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-调试会员等级相关接口"><span class="mr-2">40</span><span>商品服务-API-新增商品-调试会员等级相关接口</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-调试会员等级相关接口-1"><span class="mr-2">41</span><span>商品服务-API-新增商品-调试会员等级相关接口</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-获取分类关联的品牌"><span class="mr-2">42</span><span>商品服务-API-新增商品-获取分类关联的品牌</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-获取分类下所有分组以及属性"><span class="mr-2">43</span><span>商品服务-API-新增商品-获取分类下所有分组以及属性</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-商品新增vo抽取"><span class="mr-2">44</span><span>商品服务-API-新增商品-商品新增vo抽取</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-商品新增业务流程分析"><span class="mr-2">45</span><span>商品服务-API-新增商品-商品新增业务流程分析</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-保存SPU基本信息"><span class="mr-2">46</span><span>商品服务-API-新增商品-保存SPU基本信息</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-保存SKU基本信息"><span class="mr-2">47</span><span>商品服务-API-新增商品-保存SKU基本信息</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-调用远程服务保存优惠等信息"><span class="mr-2">48</span><span>商品服务-API-新增商品-调用远程服务保存优惠等信息</span></a></li><li><a class="is-flex" href="#商品服务-API-新增商品-商品保存其他问题处理"><span class="mr-2">49</span><span>商品服务-API-新增商品-商品保存其他问题处理</span></a></li><li><a class="is-flex" href="#商品服务-API-商品管理-SPU检索"><span class="mr-2">50</span><span>商品服务-API-商品管理-SPU检索</span></a></li><li><a class="is-flex" href="#商品服务-API-商品管理-SKU检索"><span class="mr-2">51</span><span>商品服务-API-商品管理-SKU检索</span></a></li><li><a class="is-flex" href="#结束语"><span class="mr-2">52</span><span>结束语</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div><p class="help">Subscribe to get the lastest update!</p></form></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Blog/"><span class="level-start"><span class="level-item">Blog</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Business/"><span class="level-start"><span class="level-item">Business</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CataLog/"><span class="level-start"><span class="level-item">CataLog</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/DLMS/"><span class="level-start"><span class="level-item">DLMS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Hello-World/"><span class="level-start"><span class="level-item">Hello World</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Interview/"><span class="level-start"><span class="level-item">Interview</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JDBC/"><span class="level-start"><span class="level-item">JDBC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaSE/"><span class="level-start"><span class="level-item">JavaSE</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/MarkDown/"><span class="level-start"><span class="level-item">MarkDown</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/ShopMall/"><span class="level-start"><span class="level-item">ShopMall</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/redis/"><span class="level-start"><span class="level-item">redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="level-start"><span class="level-item">多线程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ZhangYao&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2018 - 2021 ZhangYao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span>©版权说明:本网站所有内容均收集于互联网或自己创作,方便于网友与自己学习交流,如有侵权,请留言,立即处理.</span><script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1279030921&amp;web_id=1279030921"></script><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://www.aizhangyao.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://s9.cnzz.com/z_stat.php?id=1279030921&amp;web_id=1279030921" async></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5ef7656a652f9d001303a427&amp;product=inline-share-buttons&amp;cms=sop" async="async"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>