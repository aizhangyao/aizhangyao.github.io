<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>八、Elasticsearch - ZhangYao&#039;s Blog</title><meta description="【摘要】elasticsearch~"><meta property="og:type" content="blog"><meta property="og:title" content="八、Elasticsearch"><meta property="og:url" content="http://www.aizhangyao.com/shop-mall/elasticsearch.html"><meta property="og:site_name" content="ZhangYao&#039;s Blog"><meta property="og:description" content="【摘要】elasticsearch~"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/elastic-logo.svg"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/4.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/5.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/7.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/8.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/9.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/10.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/11.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/29.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/34.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/35.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/37.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/49.png"><meta property="og:image" content="http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/53.png"><meta property="article:published_time" content="2020-07-26T13:17:58.000Z"><meta property="article:modified_time" content="2020-11-27T11:07:57.439Z"><meta property="article:author" content="ZhangYao"><meta property="article:tag" content="ShopMall"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/gallery/images/shop-mall/elasticsearch/elastic-logo.svg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.aizhangyao.com/shop-mall/elasticsearch.html"},"headline":"ZhangYao's Blog","image":["http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/4.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/5.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/7.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/8.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/9.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/10.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/11.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/29.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/34.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/35.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/37.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/49.png","http://www.aizhangyao.com/gallery/images/shop-mall/elasticsearch/53.png"],"datePublished":"2020-07-26T13:17:58.000Z","dateModified":"2020-11-27T11:07:57.439Z","author":{"@type":"Person","name":"ZhangYao"},"description":"【摘要】elasticsearch~"}</script><link rel="canonical" href="http://www.aizhangyao.com/shop-mall/elasticsearch.html"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ZhangYao&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/aizhangyao"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-07-26T13:17:58.000Z" title="2020-07-26T13:17:58.000Z">2020-07-26</time><span class="level-item"><a class="link-muted" href="/categories/ShopMall/">ShopMall</a></span><span class="level-item">31 分钟 读完 (大约 4622 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">八、Elasticsearch</h1><div class="content"><p>【摘要】elasticsearch~<br><img src="/gallery/images/shop-mall/elasticsearch/elastic-logo.svg" alt=""></p>
<a id="more"></a>

<h1 id="Elasticsearch简介"><a href="#Elasticsearch简介" class="headerlink" title="Elasticsearch简介"></a>Elasticsearch简介</h1><p><a href="https://www.elastic.co/cn/what-is/elasticsearch">https://www.elastic.co/cn/what-is/elasticsearch</a><br>全文搜索属于最常见的需求，开源的Elasticsearch是目前全文搜索引擎的首选。<br>它可以快速地储存、搜索和分析海量数据。维基百科。Stack Overflow、Github都采用它。<br>Elastic的底层是开源库Lucene。但是，你没有办法直接用Lucene，必须自己写代码区调用它的接口。Elastic是Lucene封装的，提供了REST API的操作接口，开箱即用。<br>REST API：天然的跨平台。<br>官方文档：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a><br>官方中文：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html</a><br>社区中文：<a href="http://elasticsearch.cn">http://elasticsearch.cn</a></p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="Index-索引"><a href="#Index-索引" class="headerlink" title="Index(索引)"></a>Index(索引)</h2><p>动词，相当于MySQL中的insert；<br>名词，相当于MySQL中的Database；</p>
<h2 id="Type-类型"><a href="#Type-类型" class="headerlink" title="Type(类型)"></a>Type(类型)</h2><p>在Index(索引)中，可以定义一个或多个类型。<br>类似于MySQL中的Table；每一种类型的数据放在一起；</p>
<h2 id="Document-文档"><a href="#Document-文档" class="headerlink" title="Document(文档)"></a>Document(文档)</h2><p>保存在某个索引(Index)下，某种类型(Type)的一个数据(Document)，文档是JSON格式的，Document就像是MySQL中的某个Table里面的内容。<br><img src="/gallery/images/shop-mall/elasticsearch/4.png" alt=""><br><img src="/gallery/images/shop-mall/elasticsearch/5.png" alt=""></p>
<h1 id="Docker上安装es"><a href="#Docker上安装es" class="headerlink" title="Docker上安装es"></a>Docker上安装es</h1><h2 id="下载镜像文件"><a href="#下载镜像文件" class="headerlink" title="下载镜像文件"></a>下载镜像文件</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:<span class="number">7.4</span>.<span class="number">2</span> <span class="comment"># 存储和检索数据</span></span><br><span class="line">docker pull kibana:<span class="number">7.4</span>.<span class="number">2</span> <span class="comment"># 可视化检索数据</span></span><br></pre></td></tr></table></figure>
<p><code>free -m</code> 可以查看linux内存使用情况。</p>
<h2 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h2><h3 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mydata/elasticsearch/config</span><br><span class="line">mkdir -p /mydata/elasticsearch/data</span><br><span class="line">echo <span class="string">"http.host:0.0.0.0"</span>&gt;&gt;/mydata/elasticsearch/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">docker <span class="keyword">run</span><span class="bash"> --name elasticsearch \</span></span><br><span class="line"><span class="bash">-p 9200:9200 -p 9300:9300 \</span></span><br><span class="line"><span class="bash">-e <span class="string">"discovery.type=single-node"</span> \</span></span><br><span class="line"><span class="bash">-e ES_JAVA_OPTS=<span class="string">"-Xms64m -Xmx128m"</span> \</span></span><br><span class="line"><span class="bash">-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml \</span></span><br><span class="line"><span class="bash">-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data \</span></span><br><span class="line"><span class="bash">-v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins \</span></span><br><span class="line"><span class="bash">-d elasticsearch:7.4.2</span></span><br><span class="line"></span><br><span class="line">chmod -R <span class="number">777</span> /mydata/elasticsearch/ <span class="comment"># 文件权限设置</span></span><br><span class="line"></span><br><span class="line">docker restart elasticsearch7.<span class="number">4.2</span></span><br></pre></td></tr></table></figure>
<p><img src="/gallery/images/shop-mall/elasticsearch/7.png" alt=""></p>
<p>以后在外面安装好插件重启即可。<br>特别注意：<code>-e ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot;</code>测试环境下，设置ES的初始内存和最大内存，否则导致过大启动不了ES。</p>
<p>使用PostMan测试ElaticSearch<br><img src="/gallery/images/shop-mall/elasticsearch/8.png" alt=""></p>
<h3 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --name kibana -e ELASTICSEARCH_URL=http://119.23.25.235:9200 -p 5601:5601 -d kibana:7.4.2</span></span><br></pre></td></tr></table></figure>

<h1 id="初步检索"><a href="#初步检索" class="headerlink" title="初步检索"></a>初步检索</h1><h2 id="cat"><a href="#cat" class="headerlink" title="_cat"></a>_cat</h2><p>GET /_cat/nodes ：查看所有节点<br>GET /_cat/health ：查看es健康状况<br>GET /_cat/master ：查看主节点<br>GET /_cat/indices ：查看所有索引 show databases;</p>
<h2 id="索引一个文档-保存"><a href="#索引一个文档-保存" class="headerlink" title="索引一个文档(保存)"></a>索引一个文档(保存)</h2><p>保存一个数据，保存在哪个索引的那个类型下面，指定用哪个唯一标识。<br>PUT customer/external/1 在customer索引下的external类型下保存1号数据为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>:<span class="string">"Zhang Yao"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PUT和POST都可以。<br>POST新增，如果不指定id，会自动生成id。指定id就会修改这个数据，并新增版本号。<br>PUT可以新增可以修改。PUT必须指定id，由于PUT需要指定id，我们一般都用来做修改操作，不指定id会报错。</p>
<h2 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET customer/external/1</span><br><span class="line">结果</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"customer"</span>,	<span class="comment">//在哪个索引</span></span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"external"</span>,	<span class="comment">//在哪个类型</span></span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,				<span class="comment">//记录id</span></span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">3</span>,			<span class="comment">//版本号</span></span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">2</span>,			<span class="comment">//并发控制字段，每次更新就会+1，用来做乐观锁</span></span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span>,		<span class="comment">//同上，主分片重新分片，如重启，就会变化</span></span><br><span class="line">    <span class="attr">"found"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"_source"</span>: &#123;			<span class="comment">//真正的内容</span></span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Zhang Yao"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新携带 ?if_seq_no=0&amp;if_primary_term=1<br>类似MySQL中的乐观锁。<br><img src="/gallery/images/shop-mall/elasticsearch/9.png" alt=""><br><img src="/gallery/images/shop-mall/elasticsearch/10.png" alt=""></p>
<h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/1/_update</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"doc"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"Yao"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>:<span class="string">"Zhang Yao 2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT customer/external/1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>:<span class="string">"Zhang Yao 2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>不同：POST操作会对比与源文档数据，如果相同不会有什么操作，文档version不增加；<br>PUT操作总会将数据重写保存并增加version版本。<br>带_updata对比元数据重新保存并增加version版本；<br>看场景：对于大并发更新，不带update;对于大并发查询偶尔更新带update;对比更新，重写计算分配规则。</p>
</blockquote>
<p>更新同时增加属性</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/1/_update</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"doc"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"Yao"</span>,<span class="attr">"age"</span>:<span class="number">23</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PUT和POST(不带_update)也可以。</p>
<h2 id="删除文档-amp-索引"><a href="#删除文档-amp-索引" class="headerlink" title="删除文档&amp;索引"></a>删除文档&amp;索引</h2><p>DELETE customer/external/_bulk<br>DELETE customer</p>
<h2 id="bulk批量API"><a href="#bulk批量API" class="headerlink" title="bulk批量API"></a>bulk批量API</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/_bulk</span><br><span class="line">&#123;<span class="attr">"index"</span>:&#123;<span class="attr">"_id"</span>:<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"Yao 1"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"index"</span>:&#123;<span class="attr">"_id"</span>:<span class="string">"2"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"Yao 2"</span>&#125;</span><br><span class="line">语法格式</span><br><span class="line">&#123;action:&#123;metadata&#125;&#125;\n</span><br><span class="line">&#123;request body&#125;\n</span><br><span class="line"></span><br><span class="line">&#123;action:&#123;metadata&#125;&#125;\n</span><br><span class="line">&#123;request body&#125;\n</span><br><span class="line"></span><br><span class="line">复杂实例</span><br><span class="line">POST /_bulk</span><br><span class="line">&#123;<span class="attr">"delete"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"website"</span>,<span class="attr">"_type"</span>:<span class="string">"blog"</span>,<span class="attr">"_id"</span>:<span class="string">"123"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"create"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"website"</span>,<span class="attr">"_type"</span>:<span class="string">"blog"</span>,<span class="attr">"_id"</span>:<span class="string">"123"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"my first blog post"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"index"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"website"</span>,<span class="attr">"_type"</span>:<span class="string">"blog"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"my second blog post"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"update"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"website"</span>,<span class="attr">"_type"</span>:<span class="string">"blog"</span>,<span class="attr">"_id"</span>:<span class="string">"123"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"doc"</span>:&#123;<span class="attr">"title"</span>:<span class="string">"my updated blog post"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="样本测试数据"><a href="#样本测试数据" class="headerlink" title="样本测试数据"></a>样本测试数据</h2><p><a href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json">导入测试数据</a><br>POST /bank/account/_bulk<br>测试数据</p>
<p><img src="/gallery/images/shop-mall/elasticsearch/11.png" alt=""></p>
<blockquote>
<p>设置es开机自启<code>docker update 17b4e7fcb342 --restart=always</code></p>
</blockquote>
<h1 id="进阶检索"><a href="#进阶检索" class="headerlink" title="进阶检索"></a>进阶检索</h1><h2 id="SearchAPI"><a href="#SearchAPI" class="headerlink" title="SearchAPI"></a>SearchAPI</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/getting-started-search.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.x/getting-started-search.html</a><br>ES支持两种基本方式检索：</p>
<ul>
<li>一个是通过使用REST request URI 发送搜索数据 (uri+检索参数)</li>
<li>另一个是通过使用 REST request body来发送他们 (uri+请求体)</li>
</ul>
<h3 id="检索信息"><a href="#检索信息" class="headerlink" title="检索信息"></a>检索信息</h3><p>GET bank/_search?q=*&amp;sort=account_number:asc</p>
<ul>
<li><p>一切检索从_search开始<br><code>GET bank/_search</code>                                ：检索bank下所有信息，包括type和docs<br><code>GET bank/_search?q=*&amp;sort=account_number:asc</code>    ：请求参数方式检索<br>响应结果解释：<br><code>took</code> – Elasticsearch执行搜索的时间(毫秒)<br><code>time_out</code> – 告诉我们搜索是否超时<br><code>_shards</code> – 告诉我们多少个分片被搜索了，以及统计成功/失败的搜索分片<br><code>hits</code> – 搜索结果<br><code>hits.total</code> – 搜索结果<br><code>hits.hits</code> – 实际的搜索结构数组(默认为前10的文档)<br><code>_source</code> – 结果的排序key(键)(没有则按score排序)<br><code>_score</code>和<code>max_score</code> – 相关性得分和最高得分(全文检索用)</p>
</li>
<li><p>uri+请求体进行检索</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"sort"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"balance"</span>: &#123;</span><br><span class="line">        <span class="attr">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HTTP客户端工具(PostMan)，GET请求不能携带请求体，我们变为POST也是一样的。我们POST一个JSON风格的查询请求体到_search API。<br>需要了解，一旦搜索的结果被返回，Elasticsearch就完成了这次请求，并且不会维护任何服务端的资源或者结果的cursor(游标)。</p>
</li>
</ul>
<h2 id="Query-DSL"><a href="#Query-DSL" class="headerlink" title="Query DSL"></a>Query DSL</h2><h3 id="基本语法格式"><a href="#基本语法格式" class="headerlink" title="基本语法格式"></a>基本语法格式</h3><p>Elasticsearch提供了一个可以执行查询的JSON风格的DSL(domain-specific language领域特定语言)。这个被称为Query DSL。该查询语言非常全面，并且刚开始的时候感觉有点复杂，真正学好它的方法是从一些基本的示例开始的。</p>
<ul>
<li>一个查询语句的典型结构<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	QUERY_NAME:&#123;</span><br><span class="line">		ARGUMENT:VALUE,</span><br><span class="line">		ARGUMENT:VALUE,...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>如果是针对某个字段，那么他的结构如下：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	QUERY_NAME:&#123;</span><br><span class="line">		FIELD_NAME:&#123;</span><br><span class="line">			ARGUMENT:VALUE,</span><br><span class="line">			ARGUMENT:VALUE,...</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
示例：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">	<span class="attr">"from"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">"sort"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"balance"</span>: &#123;</span><br><span class="line">        <span class="attr">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<code>query</code>定义如何查询<br><code>match_all</code>查询类型【代表查询所有的所以】，es中可以在query中组合非常多的查询类型完成复杂查询。<br>除了<code>query</code>参数之外，我们也可以传递其他的参数以改变查询结果。如<code>sort</code>和<code>size</code>。<br><code>from+size</code>限定，完成分页功能。<br><code>sort</code>排序，多字段排序，会在前序字段相等时后续字段内部排序，否则以前序为准。</li>
</ul>
<h3 id="返回部分字段"><a href="#返回部分字段" class="headerlink" title="返回部分字段"></a>返回部分字段</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"sort"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"balance"</span>: &#123;</span><br><span class="line">        <span class="attr">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"from"</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">"_source"</span>: [</span><br><span class="line">    <span class="string">"account_number"</span>,</span><br><span class="line">    <span class="string">"balance"</span>,</span><br><span class="line">    <span class="string">"firstname"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="match-匹配查询"><a href="#match-匹配查询" class="headerlink" title="match[匹配查询]"></a>match[匹配查询]</h3><ul>
<li><p>基本类型(非字符串)，精确匹配</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match"</span>: &#123;</span><br><span class="line">      <span class="attr">"account_number"</span>: <span class="string">"20"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>match返回account_number=20的。</p>
</li>
<li><p>字符串，全文检索</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match"</span>: &#123;</span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">"mill"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终查询出address中包含mill单词的所有记录。<br>match当搜索字符串类型的时候，会进行全文检索，并且每条记录有相关性得分。</p>
</li>
<li><p>字符串，多个单词(分词+全文检索)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match"</span>: &#123;</span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">"mill road"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终查询出address中包含mill或者road或者mill road的所有记录，并给出相关性得分。</p>
</li>
</ul>
<h3 id="match-phrase-短语匹配"><a href="#match-phrase-短语匹配" class="headerlink" title="match_phrase[短语匹配]"></a>match_phrase[短语匹配]</h3><p>当需要匹配的值当成一个整体单词(不分词)进行检索。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_phrase"</span>: &#123;</span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">"mill road"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查出addres中包含mill road的所有记录，并给出相关性得分。</p>
<h3 id="multi-match-多字段匹配"><a href="#multi-match-多字段匹配" class="headerlink" title="multi_match[多字段匹配]"></a>multi_match[多字段匹配]</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"multi_match"</span>: &#123;</span><br><span class="line">      <span class="attr">"query"</span>: <span class="string">"mill"</span>,</span><br><span class="line">      <span class="attr">"fields"</span>: [<span class="string">"address"</span>,<span class="string">"city"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>address或者city包含mill。</p>
<h3 id="bool-复合查询"><a href="#bool-复合查询" class="headerlink" title="bool[复合查询]"></a>bool[复合查询]</h3><p>bool用来做复合查询；<br>复合语句可以合并任何其他查询语句，包括复合查询，了解这一点是很重要的。这就意味着，复合语句之间可以互相嵌套，可以表达非常复杂的逻辑。</p>
<ul>
<li>must：必须达到must列举的所有条件。</li>
<li>should：应该达到should列举的条件，如果达到会增加相关性的评分，并不会改变查询的结果。如果query中只有should且只有一种匹配规则，那么should的条件就会被作为默认匹配条件而去改变查询结果。</li>
<li>must_not：必须补上指定的情况。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"must"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"match"</span>: &#123;</span><br><span class="line">            <span class="attr">"gender"</span>: <span class="string">"M"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"match"</span>: &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"mill"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"must_not"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"match"</span>: &#123;</span><br><span class="line">            <span class="attr">"age"</span>: <span class="string">"28"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"should"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"match"</span>: &#123;</span><br><span class="line">            <span class="attr">"lastname"</span>: <span class="string">"Wallace"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
address包含mill，并且gender是M，如果lastname里面有Wallace最好不过，但是age必须不是20。</li>
</ul>
<h3 id="filter-结果过滤"><a href="#filter-结果过滤" class="headerlink" title="filter[结果过滤]"></a>filter[结果过滤]</h3><p>并不是所有的查询都需要产生分数，特别是那些仅用于”filtering”(过滤)的文档。为了不计算分数Elasticsearch会自动检查场景并优化查询的执行。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"filter"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"range"</span>: &#123;</span><br><span class="line">            <span class="attr">"age"</span>: &#123;</span><br><span class="line">              <span class="attr">"gte"</span>: <span class="number">18</span>,</span><br><span class="line">              <span class="attr">"lte"</span>: <span class="number">30</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="term-结果过滤"><a href="#term-结果过滤" class="headerlink" title="term[结果过滤]"></a>term[结果过滤]</h3><p>和match一样，匹配某个属性的值。全文检索字段用match，其他非text字段匹配用term。<br><img src="/gallery/images/shop-mall/elasticsearch/29.png" alt=""></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"term"</span>: &#123;</span><br><span class="line">      <span class="attr">"balance"</span>: <span class="string">"32838"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="aggregations-执行聚合"><a href="#aggregations-执行聚合" class="headerlink" title="aggregations[执行聚合]"></a>aggregations[执行聚合]</h3><p>聚合提供了从数据中分组和提取数据的能力。最简单的聚合方法大于等于SQL GROUP BY和SQL聚合函数。在Elasticsearch中，您有执行搜索返回hits(命中结果)，并且同时返回聚合结果，把一个响应的所有hits(命中结果)分隔开的能力。这是非常强大且有效的，您可以执行查询和多个聚合，并且在一次使用中得到各自的(任何一个的)返回结果，使用一次简洁和简化的API来避免网络往返。</p>
<ul>
<li><p>搜索address中包含mill的所有人的年龄分布以及平均年龄，但不显示这些人的详情。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match"</span>: &#123;</span><br><span class="line">      <span class="attr">"address"</span>: <span class="string">"mill"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"ageAgg"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"age"</span>,</span><br><span class="line">        <span class="attr">"size"</span>: <span class="number">10</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"ageAvg"</span>: &#123;</span><br><span class="line">      <span class="attr">"avg"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"age"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"balanceAvg"</span>: &#123;</span><br><span class="line">      <span class="attr">"avg"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"balance"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------</span><br><span class="line">size:0 不显示搜索数据</span><br><span class="line">aggs:执行聚合。聚合语法入下。</span><br><span class="line">"aggs": &#123;</span><br><span class="line">	"aggs_name 这次聚合的名字，方便展示在结果集中": &#123;</span><br><span class="line">		<span class="string">"AGG_TYPE 聚合的类型(avg,term,terms)"</span>&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ex:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"ageAgg"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"age"</span>,</span><br><span class="line">        <span class="attr">"size"</span>: <span class="number">100</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">        <span class="attr">"ageAvg"</span>: &#123;</span><br><span class="line">          <span class="attr">"avg"</span>: &#123;</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"balance"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>复杂：按照年龄聚合，并且请求这些年龄段的这些人的平均薪资</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"ageAgg"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"age"</span>,</span><br><span class="line">        <span class="attr">"size"</span>: <span class="number">100</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">        <span class="attr">"genderAgg"</span>: &#123;</span><br><span class="line">          <span class="attr">"terms"</span>: &#123;</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gender.keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">            <span class="attr">"balanceAgg"</span>: &#123;</span><br><span class="line">              <span class="attr">"avg"</span>: &#123;</span><br><span class="line">                <span class="attr">"field"</span>: <span class="string">"balance"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"ageBalanceAvg"</span>: &#123;</span><br><span class="line">          <span class="attr">"avg"</span>: &#123;</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"balance"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h2><h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><ul>
<li>核心简单域类型<ul>
<li>字符串: string</li>
<li>整数 : byte, short, integer, long</li>
<li>浮点数: float, double</li>
<li>布尔型: boolean</li>
<li>日期: date</li>
</ul>
</li>
<li>复合类型</li>
<li>地理类型</li>
<li>特定类型</li>
<li>多字段<br><img src="/gallery/images/shop-mall/elasticsearch/34.png" alt=""><br><img src="/gallery/images/shop-mall/elasticsearch/35.png" alt=""><h3 id="映射-Mapping"><a href="#映射-Mapping" class="headerlink" title="映射(Mapping)"></a>映射(Mapping)</h3>Mapping是用来定义一个文档(document)，以及它所包含的属性(field)是如何存储和索引的。比如，使用Mapping来定义：</li>
<li>哪些字符串属性应该被看做全文本属性。(full text fields)</li>
<li>哪些属性包含数组、日期或者地理位置。</li>
<li>文档中的所有属性是否都能被索引。(_all配置)</li>
<li>日期的格式。</li>
<li>自定义映射规则来执行动态添加属性。</li>
<li>查看mapping信息：<br>GET /bank/_mapping</li>
<li>修改mapping信息：<br><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/mapping-intro.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/mapping-intro.html</a><br>自动猜测的映射类型<br><img src="/gallery/images/shop-mall/elasticsearch/37.png" alt=""></li>
</ul>
<h3 id="新版本改…"><a href="#新版本改…" class="headerlink" title="新版本改…"></a>新版本改…</h3><p>es7及以上移除了type的概念。</p>
<ul>
<li>关系型数据库中两个数据显示是独立的，即使他们里面有相同名称的列也不影响使用，但es中不是这样的。elasticsearch是基于Lucene开发的搜索引擎，而es中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。<ul>
<li>两个不同type下的两个user_name，在es同一个索引下其实被认为是同一个filed，你必须在两个不同type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。</li>
<li>去掉type就是为了提高es处理数据的效率。</li>
</ul>
</li>
</ul>
<p>Elasticsearch 7.x</p>
<ul>
<li>URL中的type参数为可选。比如，索引一个文档不再要求提供文档类型。</li>
</ul>
<p>Elasticsearch 8.x</p>
<ul>
<li>不再支持URL中的type参数。</li>
</ul>
<blockquote>
<p>解决：<br>1.将索引从多类型迁移到单类型，每种类型文档一个独立索引。<br>2.将已存在的索引下的数据类型，全部迁移到指定位置即可。详见数据迁移。</p>
</blockquote>
<h4 id="创建映射"><a href="#创建映射" class="headerlink" title="创建映射"></a>创建映射</h4><p>1.创建索引并指定映射。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_mapping</span><br><span class="line"></span><br><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">      <span class="attr">"age"</span>:&#123;<span class="attr">"type"</span>: <span class="string">"integer"</span>&#125;,</span><br><span class="line">      <span class="attr">"email"</span>:&#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;,</span><br><span class="line">      <span class="attr">"name"</span>:&#123;<span class="attr">"type"</span>: <span class="string">"text"</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加新的字段映射"><a href="#添加新的字段映射" class="headerlink" title="添加新的字段映射"></a>添加新的字段映射</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"properties"</span>: &#123;</span><br><span class="line">    <span class="attr">"employee-id"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"keyword"</span>,</span><br><span class="line">      <span class="attr">"index"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新映射"><a href="#更新映射" class="headerlink" title="更新映射"></a>更新映射</h4><p>对于已存在的映射字段，我们不能更新。更新必须创建新的索引进行数据迁移。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">PUT /newbank</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">              <span class="attr">"account_number"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"long"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"address"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"text"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"age"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"long"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"balance"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"long"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"city"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"email"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"employer"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"firstname"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"gender"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"lastname"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">          <span class="attr">"fields"</span> : &#123;</span><br><span class="line">            <span class="attr">"keyword"</span> : &#123;</span><br><span class="line">              <span class="attr">"type"</span> : <span class="string">"keyword"</span>,</span><br><span class="line">              <span class="attr">"ignore_above"</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"state"</span> : &#123;</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h4><p>先创建出newbank的正确映射。然后使用如下方式进行数据迁移。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"source"</span>: &#123;</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"bank"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dest"</span>: &#123;</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"newbank"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p>一个tokenizer(分词器)接受一个字符流，将之分割为独立的tokens(词元，通常是独立的单词)，然后输出tokens流。<br>例如，whitespace tokenizer遇到空白字符时分割文本。它会将文本”Quick brown fox!”分割为[Quick,brown,fox!]。<br>该tokenizer(分词器)还负责记录各个term(词条)的顺序或position位置(用于phrase短语和word proximity词近邻查询)，以及term(词条)所代表的原始word(单词)的start(起始)和end(结束)的character offsets(字符偏移量)(用于高亮显示搜索的内容)。Elasticsearch提供了很多内置的分词器，可以用来构建custom analyzers(自定义分词器)。</p>
<h4 id="安装ik分词器"><a href="#安装ik分词器" class="headerlink" title="安装ik分词器"></a>安装ik分词器</h4><blockquote>
<p>注意：不能用默认elasticsearch-plugin install xxx.zip进行安装。<br><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.4.2">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.4.2</a> 对应es版本安装</p>
</blockquote>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">进入es容器内部 plugins目录</span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line">wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.<span class="number">4.2</span>/elasticsearch-analysis-ik-<span class="number">7.4</span>.<span class="number">2</span>.zip</span><br><span class="line">uzip elasticsearch-analysis-ik-<span class="number">7.4</span>.<span class="number">2</span>.zip</span><br><span class="line">rm -rf*.zip</span><br><span class="line">mv elasticsearch/ik</span><br><span class="line">可以确认是否安装好了分词器</span><br><span class="line">cd ../bin</span><br><span class="line">elasticsearch plugin list 即可列出系统的分词器</span><br><span class="line"></span><br><span class="line">docker restart elasticsearch <span class="comment"># 需要重启es</span></span><br></pre></td></tr></table></figure>

<h4 id="测试分词器"><a href="#测试分词器" class="headerlink" title="测试分词器"></a>测试分词器</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"text"</span>: <span class="string">"我是中国人"</span></span><br><span class="line">&#125;</span><br><span class="line">效果</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"我"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"&lt;IDEOGRAPHIC&gt;"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"是"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"&lt;IDEOGRAPHIC&gt;"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"中"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"&lt;IDEOGRAPHIC&gt;"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"国"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"&lt;IDEOGRAPHIC&gt;"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"人"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"&lt;IDEOGRAPHIC&gt;"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用ik_smart分词器。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"analyzer"</span>:<span class="string">"ik_smart"</span>,</span><br><span class="line">	<span class="attr">"text"</span>: <span class="string">"我是中国人"</span></span><br><span class="line">&#125;</span><br><span class="line">效果</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"我"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"是"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"中国人"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用ik_max_word分词器。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"analyzer"</span>:<span class="string">"ik_max_word"</span>,</span><br><span class="line">	<span class="attr">"text"</span>: <span class="string">"我是中国人"</span></span><br><span class="line">&#125;</span><br><span class="line">效果</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"我"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"是"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"中国人"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"中国"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"token"</span> : <span class="string">"国人"</span>,</span><br><span class="line">      <span class="attr">"start_offset"</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"end_offset"</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="attr">"position"</span> : <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>能够看出不同的分词器，分词有明显的区别，所以以后定义一个索引不能再使用默认的mapping了，要手工建立mapping，因为要选择分词器。</p>
<h4 id="自定义词库"><a href="#自定义词库" class="headerlink" title="自定义词库"></a>自定义词库</h4><p>修改<code>/mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">properties</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_dict"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"ext_stopwords"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"remote_ext_dict"</span>&gt;</span>http://119.23.25.235/es/fenci.txt<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置完成后重启es。测试自定义词库。<br><img src="/gallery/images/shop-mall/elasticsearch/49.png" alt=""><br>更新完成后，es只会对新增的数据用新词分词。历史数据是不会重新分词的。如果想要历史数据重写分词。只需要执行：<br>POST my_index/_update_by_query?conflicts=proceed</p>
<h1 id="Elasticsearch-Rest-Client"><a href="#Elasticsearch-Rest-Client" class="headerlink" title="Elasticsearch-Rest-Client"></a>Elasticsearch-Rest-Client</h1><p>(1).9300:TCP</p>
<ul>
<li>spring-data-elasticsearch:transport-api.jar<ul>
<li>springboot版本不同，transport-api.jar不同，不能适配es版本。</li>
<li>7.x已经不建议使用，8以后就要废弃。</li>
</ul>
</li>
</ul>
<p>(2).9200:HTTP</p>
<ul>
<li>JestClient：非官方，更新慢。</li>
<li>RestTemplate：模拟发HTTP请求，ES很多操作需要自己封装，麻烦。</li>
<li>HttpClient：同上。</li>
<li>Elasticsearch-Rest-Client：官方RestClient，封装了ES操作，API层次分明，上手简单。<br>最终选择Elasticsearch-Rest-Client(elasticsearch-rest-high-level-client)<br><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.x/java-rest-high.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.x/java-rest-high.html</a></li>
</ul>
<h2 id="Spring-Boot整合"><a href="#Spring-Boot整合" class="headerlink" title="Spring Boot整合"></a>Spring Boot整合</h2><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><img src="/gallery/images/shop-mall/elasticsearch/53.png" alt=""></p>
<h1 id="附录-安装Nginx"><a href="#附录-安装Nginx" class="headerlink" title="附录-安装Nginx"></a>附录-安装Nginx</h1><ul>
<li>随便启动一个nginx实例，只是为了复制出配置<ul>
<li>docker run -p 80:80 –name nginx -d nginx:1.10</li>
</ul>
</li>
<li>将容器内的配置文件拷贝到当前目录：docker container cp nginx:/etc/nginx .<ul>
<li>别忘记了后面的.</li>
</ul>
</li>
<li>修改文件名称：mv nginx conf 把这个conf移动到/mydata/nginx下</li>
<li>终止原容器：docker stop nginx</li>
<li>执行命令删除原容器：docker rm $ContainerId</li>
<li>创建新的nginx：执行以下命令<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -p 80:80 --name nginx \</span></span><br><span class="line"><span class="bash">-v /mydata/nginx/html:/usr/share/nginx/html \</span></span><br><span class="line"><span class="bash">-v /mydata/nginx/logs:/var/<span class="built_in">log</span>/nginx \</span></span><br><span class="line"><span class="bash">-v /mydata/nginx/conf:/etc/nginx \</span></span><br><span class="line"><span class="bash">-d nginx:1.10</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZwz9dvddod8c7o1rqic33Z nginx]# pwd</span><br><span class="line">/mydata/nginx</span><br><span class="line">[root@iZwz9dvddod8c7o1rqic33Z nginx]# ls</span><br><span class="line">conf  html  logs</span><br><span class="line">[root@iZwz9dvddod8c7o1rqic33Z es]# pwd</span><br><span class="line">/mydata/nginx/html/es</span><br><span class="line">[root@iZwz9dvddod8c7o1rqic33Z es]# ls</span><br><span class="line">fenci.txt</span><br></pre></td></tr></table></figure>

</li>
</ul>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ShopMall/">ShopMall</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5ef7656a652f9d001303a427&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/gallery/donate/alipay.jpg" alt="支付宝"></span></a><a class="button is-warning donate" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="zhangyao9707@163.com"><input type="hidden" name="currency_code" value="USD"></form><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/gallery/donate/wechat.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/shop-mall/shop-business.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">九、商城业务 | 商品上架</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/shop-mall/distributed-foundation-summary.html"><span class="level-item">七、微服务分布式电商系统--分布式基础篇总结</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: 'df1c18ac8723dc1fbe18cd2dd57eadcd',
            repo: 'aizhangyao.github.io',
            owner: 'aizhangyao',
            clientID: '872c6e0704b3561faaca',
            clientSecret: '218979ed7b4abf1e403c79184e02808978a42558',
            admin: ["aizhangyao"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: 'last',
            
            
            enableHotKey: true
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpg" alt="ZhangYao"></figure><p class="title is-size-4 is-block line-height-inherit">ZhangYao</p><p class="is-size-6 is-block">Java Programmer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">64</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">20</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/aizhangyao" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/aizhangyao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#Elasticsearch简介"><span class="mr-2">1</span><span>Elasticsearch简介</span></a></li><li><a class="is-flex" href="#基本概念"><span class="mr-2">2</span><span>基本概念</span></a><ul class="menu-list"><li><a class="is-flex" href="#Index-索引"><span class="mr-2">2.1</span><span>Index(索引)</span></a></li><li><a class="is-flex" href="#Type-类型"><span class="mr-2">2.2</span><span>Type(类型)</span></a></li><li><a class="is-flex" href="#Document-文档"><span class="mr-2">2.3</span><span>Document(文档)</span></a></li></ul></li><li><a class="is-flex" href="#Docker上安装es"><span class="mr-2">3</span><span>Docker上安装es</span></a><ul class="menu-list"><li><a class="is-flex" href="#下载镜像文件"><span class="mr-2">3.1</span><span>下载镜像文件</span></a></li><li><a class="is-flex" href="#创建实例"><span class="mr-2">3.2</span><span>创建实例</span></a><ul class="menu-list"><li><a class="is-flex" href="#Elasticsearch"><span class="mr-2">3.2.1</span><span>Elasticsearch</span></a></li><li><a class="is-flex" href="#Kibana"><span class="mr-2">3.2.2</span><span>Kibana</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#初步检索"><span class="mr-2">4</span><span>初步检索</span></a><ul class="menu-list"><li><a class="is-flex" href="#cat"><span class="mr-2">4.1</span><span>_cat</span></a></li><li><a class="is-flex" href="#索引一个文档-保存"><span class="mr-2">4.2</span><span>索引一个文档(保存)</span></a></li><li><a class="is-flex" href="#查询文档"><span class="mr-2">4.3</span><span>查询文档</span></a></li><li><a class="is-flex" href="#更新文档"><span class="mr-2">4.4</span><span>更新文档</span></a></li><li><a class="is-flex" href="#删除文档-amp-索引"><span class="mr-2">4.5</span><span>删除文档&amp;索引</span></a></li><li><a class="is-flex" href="#bulk批量API"><span class="mr-2">4.6</span><span>bulk批量API</span></a></li><li><a class="is-flex" href="#样本测试数据"><span class="mr-2">4.7</span><span>样本测试数据</span></a></li></ul></li><li><a class="is-flex" href="#进阶检索"><span class="mr-2">5</span><span>进阶检索</span></a><ul class="menu-list"><li><a class="is-flex" href="#SearchAPI"><span class="mr-2">5.1</span><span>SearchAPI</span></a><ul class="menu-list"><li><a class="is-flex" href="#检索信息"><span class="mr-2">5.1.1</span><span>检索信息</span></a></li></ul></li><li><a class="is-flex" href="#Query-DSL"><span class="mr-2">5.2</span><span>Query DSL</span></a><ul class="menu-list"><li><a class="is-flex" href="#基本语法格式"><span class="mr-2">5.2.1</span><span>基本语法格式</span></a></li><li><a class="is-flex" href="#返回部分字段"><span class="mr-2">5.2.2</span><span>返回部分字段</span></a></li><li><a class="is-flex" href="#match-匹配查询"><span class="mr-2">5.2.3</span><span>match[匹配查询]</span></a></li><li><a class="is-flex" href="#match-phrase-短语匹配"><span class="mr-2">5.2.4</span><span>match_phrase[短语匹配]</span></a></li><li><a class="is-flex" href="#multi-match-多字段匹配"><span class="mr-2">5.2.5</span><span>multi_match[多字段匹配]</span></a></li><li><a class="is-flex" href="#bool-复合查询"><span class="mr-2">5.2.6</span><span>bool[复合查询]</span></a></li><li><a class="is-flex" href="#filter-结果过滤"><span class="mr-2">5.2.7</span><span>filter[结果过滤]</span></a></li><li><a class="is-flex" href="#term-结果过滤"><span class="mr-2">5.2.8</span><span>term[结果过滤]</span></a></li><li><a class="is-flex" href="#aggregations-执行聚合"><span class="mr-2">5.2.9</span><span>aggregations[执行聚合]</span></a></li></ul></li><li><a class="is-flex" href="#Mapping"><span class="mr-2">5.3</span><span>Mapping</span></a><ul class="menu-list"><li><a class="is-flex" href="#字段类型"><span class="mr-2">5.3.1</span><span>字段类型</span></a></li><li><a class="is-flex" href="#映射-Mapping"><span class="mr-2">5.3.2</span><span>映射(Mapping)</span></a></li><li><a class="is-flex" href="#数据迁移"><span class="mr-2">5.3.3</span><span>数据迁移</span></a></li><li><a class="is-flex" href="#自定义词库"><span class="mr-2">5.3.4</span><span>自定义词库</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#Elasticsearch-Rest-Client"><span class="mr-2">6</span><span>Elasticsearch-Rest-Client</span></a><ul class="menu-list"><li><a class="is-flex" href="#Spring-Boot整合"><span class="mr-2">6.1</span><span>Spring Boot整合</span></a></li><li><a class="is-flex" href="#配置"><span class="mr-2">6.2</span><span>配置</span></a></li><li><a class="is-flex" href="#使用"><span class="mr-2">6.3</span><span>使用</span></a></li></ul></li><li><a class="is-flex" href="#附录-安装Nginx"><span class="mr-2">7</span><span>附录-安装Nginx</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div><p class="help">Subscribe to get the lastest update!</p></form></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Blog/"><span class="level-start"><span class="level-item">Blog</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Business/"><span class="level-start"><span class="level-item">Business</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CataLog/"><span class="level-start"><span class="level-item">CataLog</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/DLMS/"><span class="level-start"><span class="level-item">DLMS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Hello-World/"><span class="level-start"><span class="level-item">Hello World</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JDBC/"><span class="level-start"><span class="level-item">JDBC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaSE/"><span class="level-start"><span class="level-item">JavaSE</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/MarkDown/"><span class="level-start"><span class="level-item">MarkDown</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/ShopMall/"><span class="level-start"><span class="level-item">ShopMall</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/redis/"><span class="level-start"><span class="level-item">redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="level-start"><span class="level-item">多线程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9D%82%E8%AE%B0/"><span class="level-start"><span class="level-item">杂记</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ZhangYao&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2018 - 2020 ZhangYao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span>©版权说明:本网站所有内容均收集于互联网或自己创作,方便于网友与自己学习交流,如有侵权,请留言,立即处理.</span><script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1279030921&amp;web_id=1279030921"></script><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://www.aizhangyao.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://s9.cnzz.com/z_stat.php?id=1279030921&amp;web_id=1279030921" async></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5ef7656a652f9d001303a427&amp;product=inline-share-buttons&amp;cms=sop" async="async"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>